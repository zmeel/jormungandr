<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Jormungandr</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded affix "><a href="introduction.html">Introduction</a></li><li class="expanded "><a href="concepts/introduction.html"><strong aria-hidden="true">1.</strong> General Concepts</a></li><li><ol class="section"><li class="expanded "><a href="concepts/blockchain.html"><strong aria-hidden="true">1.1.</strong> Blockchain concepts</a></li><li class="expanded "><a href="concepts/stake.html"><strong aria-hidden="true">1.2.</strong> Stake</a></li><li class="expanded "><a href="concepts/node.html"><strong aria-hidden="true">1.3.</strong> Node organisation</a></li><li class="expanded "><a href="concepts/network.html"><strong aria-hidden="true">1.4.</strong> Network overview</a></li></ol></li><li class="expanded "><a href="quickstart/introduction.html"><strong aria-hidden="true">2.</strong> Quickstart</a></li><li><ol class="section"><li class="expanded "><a href="quickstart/01_command_line.html"><strong aria-hidden="true">2.1.</strong> Command lines tools</a></li><li class="expanded "><a href="quickstart/02_passive_node.html"><strong aria-hidden="true">2.2.</strong> Starting a passive node</a></li><li class="expanded "><a href="quickstart/03_rest_api.html"><strong aria-hidden="true">2.3.</strong> REST API</a></li><li class="expanded "><a href="quickstart/04_explorer.html"><strong aria-hidden="true">2.4.</strong> Explorer API</a></li><li class="expanded "><a href="quickstart/05_leader_candidate.html"><strong aria-hidden="true">2.5.</strong> Starting as a leader candidate</a></li></ol></li><li class="expanded "><a href="configuration/introduction.html"><strong aria-hidden="true">3.</strong> Configuration</a></li><li><ol class="section"><li class="expanded "><a href="configuration/logging.html"><strong aria-hidden="true">3.1.</strong> Logging</a></li><li class="expanded "><a href="configuration/network.html"><strong aria-hidden="true">3.2.</strong> Node network</a></li><li class="expanded "><a href="configuration/mempool.html"><strong aria-hidden="true">3.3.</strong> Fragment Pool</a></li><li class="expanded "><a href="configuration/leadership.html"><strong aria-hidden="true">3.4.</strong> Leader Events</a></li></ol></li><li class="expanded "><a href="jcli/introduction.html"><strong aria-hidden="true">4.</strong> jcli</a></li><li><ol class="section"><li class="expanded "><a href="jcli/key.html"><strong aria-hidden="true">4.1.</strong> Cryptographic keys</a></li><li class="expanded "><a href="jcli/address.html"><strong aria-hidden="true">4.2.</strong> Address</a></li><li class="expanded "><a href="jcli/transaction.html"><strong aria-hidden="true">4.3.</strong> Transaction</a></li><li class="expanded "><a href="jcli/certificate.html"><strong aria-hidden="true">4.4.</strong> Certificate</a></li><li class="expanded "><a href="jcli/genesis.html"><strong aria-hidden="true">4.5.</strong> Genesis</a></li><li class="expanded "><a href="jcli/rest.html"><strong aria-hidden="true">4.6.</strong> REST</a></li></ol></li><li class="expanded "><a href="stake_pool/introduction.html"><strong aria-hidden="true">5.</strong> staking and stake pool</a></li><li><ol class="section"><li class="expanded "><a href="stake_pool/delegating_stake.html"><strong aria-hidden="true">5.1.</strong> delegating your stake</a></li><li class="expanded "><a href="stake_pool/registering_stake_pool.html"><strong aria-hidden="true">5.2.</strong> registering stake pool</a></li></ol></li><li class="expanded "><a href="advanced/introduction.html"><strong aria-hidden="true">6.</strong> Advanced</a></li><li><ol class="section"><li class="expanded "><a href="advanced/01_the_genesis_block.html"><strong aria-hidden="true">6.1.</strong> Genesis block</a></li><li class="expanded "><a href="advanced/02_starting_bft_blockchain.html"><strong aria-hidden="true">6.2.</strong> Starting a bft blockchain</a></li><li class="expanded "><a href="advanced/03_starting_genesis_praos_blockchain.html"><strong aria-hidden="true">6.3.</strong> Starting a genesis blockchain</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Jormungandr</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#jormungandr-user-guide" id="jormungandr-user-guide">Jormungandr User Guide</a></h1>
<p>Welcome to the Jormungandr User Guide.</p>
<p>Jormungandr is a node implementation, written in rust, with the
initial aim to support the Ouroboros type of consensus protocol.</p>
<p>A node is a participant of a blockchain network, continuously making,
sending, receiving, and validating blocks. Each node is responsible
to make sure that all the rules of the protocol are followed.</p>
<h2><a class="header" href="#mythology" id="mythology">Mythology</a></h2>
<p>Jörmungandr refers to the <em>Midgard Serpent</em> in Norse mythology. It is a hint to
<em>Ouroboros</em>, the Ancient Egyptian serpent, who eat its own tail, as well as the
<a href="https://eprint.iacr.org/2016/889.pdf">IOHK paper</a> on proof of stake.</p>
<h1><a class="header" href="#general-concepts" id="general-concepts">General Concepts</a></h1>
<p>This chapter covers the general concepts of the blockchain, and their application
in the node, and is followed by the node organisation and the user interaction with it.</p>
<h1><a class="header" href="#blockchain-concepts" id="blockchain-concepts">Blockchain concepts</a></h1>
<h2><a class="header" href="#time" id="time">Time</a></h2>
<p>Slots represent the basic unit of time in the blockchain, and at each slot
a block could be present.</p>
<p>Consecutive slots are grouped into epochs, which have updatable size defined
by the protocol.</p>
<h2><a class="header" href="#fragments" id="fragments">Fragments</a></h2>
<p>Fragments are part of the blockchain data that represent all the possible
events related to the blockchain health (e.g. update to the protocol), but
also and mainly the general recording of information like transactions and
certificates.</p>
<h2><a class="header" href="#blocks" id="blocks">Blocks</a></h2>
<p>Blocks represent the spine of the blockchain, safely and securely linking
blocks in a chain, whilst grouping valid fragments together.</p>
<p>Blocks are composed of 2 parts:</p>
<ul>
<li>The header</li>
<li>The content</li>
</ul>
<p>The header link the content with the blocks securely together, while the
content is effectively a sequence of fragments.</p>
<h2><a class="header" href="#blockchain" id="blockchain">Blockchain</a></h2>
<p>The blockchain is the general set of rules and the blocks that are periodically created.
Some of the rules and settings, can be changed dynamically in the system by updates,
while some other are hardcoded in the genesis block (first block of the blockchain).</p>
<pre><code>    +-------+      +-------+
    |Genesis+&lt;-----+Block 1+&lt;--- ....
    |Header |      |Header |
    +---+---+      +---+---+
        |              |
    +---v---+      +---v---+
    |Genesis|      |Block 1|
    |Content|      |Content|
    +-------+      +-------+
</code></pre>
<h2><a class="header" href="#consensus" id="consensus">Consensus</a></h2>
<p>The node currently support the following consensus protocol:</p>
<ul>
<li>Ouroboros BFT (OBFT)</li>
<li>Ouroboros Genesis-Praos</li>
</ul>
<p>Ouroboros BFT is a simple Byzantine Fault Tolerant (BFT) protocol where the
block makers is a known list of leaders that successively create a block and
broadcast it on the network.</p>
<p>Ouroboros Genesis Praos is a proof of stake (PoS) protocol where the block
maker is made of a lottery where each stake pool has a chance proportional to
their stake to be elected to create a block. Each lottery draw is private to
each stake pool, so that the overall network doesn't know in advance who can
or cannot create blocks.</p>
<p>In Genesis-Praos slot time duration is constant, however the frequency of
creating blocks is not stable, since the creation of blocks is a probability
that is linked to the stake and consensus_genesis_praos_active_slot_coeff.</p>
<p><strong>Note</strong>: In Genesis-Praos, if there is no stake in the system, no blocks will be
created anymore starting with the next epoch.</p>
<h2><a class="header" href="#leadership" id="leadership">Leadership</a></h2>
<p>The leadership represent in abstract term, who are the overall leaders of the
system and allow each individual node to check that specific blocks are
lawfully created in the system.</p>
<p>The leadership is re-evaluated at each new epoch and is constant for the
duration of an epoch.</p>
<h2><a class="header" href="#leader" id="leader">Leader</a></h2>
<p>Leader are an abstraction related to the specific actor that have the ability
to create block; In OBFT mode, the leader just the owner of a cryptographic
key, whereas in Genesis-Praos mode, the leader is a stake pool.</p>
<h2><a class="header" href="#transaction" id="transaction">Transaction</a></h2>
<p>Transaction forms the cornerstone of the blockchain, and is one type of fragment
and also the most frequent one.</p>
<p>Transaction is composed of inputs and outputs; On one side, the inputs represent
coins being spent, and on the other side the outputs represent coins being received.</p>
<pre><code>    Inputs         Alice (80$)        Bob (20$)
                        \             /
                         \           /
                          -----------
                                100$
                             ---------
                            /         \
    Outputs            Charlie (50$)  Dan (50$)
</code></pre>
<p>Transaction have fees that are defined by the blockchain settings and the following invariant hold:</p>
<p>\[ \sum Inputs = \sum Outputs + fees \]</p>
<p>Transaction need to be authorized by each of the inputs in the transaction by their respective witness.
In the most basic case, a witness is a cryptographic signature, but depending on the type of input can
the type of witness vary.</p>
<h2><a class="header" href="#accounting" id="accounting">Accounting</a></h2>
<p>The blockchain has two methods of accounting which are interoperable:</p>
<ul>
<li>Unspent Transaction Output (UTXO)</li>
<li>Accounts</li>
</ul>
<p>UTXO behaves like cash/notes, and work like fixed denomination ticket that are
cumulated. This is the accounting model found in Bitcoin. A UTXO is uniquely
reference by its transaction ID and its index.</p>
<p>Accounts behaves like a bank account, and are simpler to use since exact amount
can be used. This is the accounting model found in Ethereum. An account is
uniquely identified by its public key.</p>
<p>Each inputs could refer arbitrarily to an account or a UTXO, and similarly
each outputs could refer to an account or represent a new UTXO.</p>
<h1><a class="header" href="#stake" id="stake">Stake</a></h1>
<p>In a proof of stake, participants are issued a stake equivalent to the amount
of coins they own. The stake is then used to allow participation in the protocol,
simply explained as:</p>
<blockquote>
<p>The more stake one has, the more likely one will participate in the good health of the network.</p>
</blockquote>
<p>When using the BFT consensus, the stake doesn't influence how the system
runs, but stake can still be manipulated for a later transition of the chain
to another consensus mode.</p>
<h2><a class="header" href="#stake-in-the-account-model" id="stake-in-the-account-model">Stake in the Account Model</a></h2>
<p>Account are represented by 1 type of address and are just composed of a public key.
The account accumulate moneys and its stake power is directly represented by the amount it contains</p>
<p>For example:</p>
<pre><code>
    A - Account with 30$ =&gt; Account A has stake of 30
    B - Account with 0$ =&gt; Account B has no stake

</code></pre>
<p>The account might have a bigger stake than what it actually contains, since it could
also have associated UTXOs, and this case is covered in the next section.</p>
<h2><a class="header" href="#stake-in-the-utxo-model" id="stake-in-the-utxo-model">Stake in the UTXO Model</a></h2>
<p>UTXO are represented by two kind of addresses:</p>
<ul>
<li>single address: those type of address have no stake associated</li>
<li>group address: those types of address have an account associated which receive the stake power of the UTXOs value</li>
</ul>
<p>For example with the following utxos:</p>
<pre><code>    UTXO1 60$ (single address) =&gt; has stake of 0

    UTXO2 50$ (group address A) \
                                 -&gt;- A - Account with 10$ =&gt; Account A has stake of 100
    UTXO3 40$ (group address A) /

    UTXO4 20$ (group address B) --&gt;- B - Account with 5$ =&gt; Account B has stake of 25
</code></pre>
<h2><a class="header" href="#stake-pool" id="stake-pool">Stake pool</a></h2>
<p>Stake pool are the trusted block creators in the genesis-praos system. A pool
is declared on the network explicitely by its owners and contains, metadata
and cryptographic material.</p>
<p>Stake pool has no stake power on their own, but participants in the network
delegate their stake to a pool for running the operation.</p>
<h2><a class="header" href="#stake-delegation" id="stake-delegation">Stake Delegation</a></h2>
<p>Stake can and need to be delegated to stake pool in the system. They can
change over time with a publication of a new delegation certificate.</p>
<p>Delegation certificate are a simple declaration statement in the form of:</p>
<pre><code>    Account 'A' delegate to Stake Pool 'Z'
</code></pre>
<p>Effectively it assign the stake in the account and its associated UTXO stake
to the pool it delegates to until another delegation certificate is made.</p>
<h1><a class="header" href="#node-organisation" id="node-organisation">Node organisation</a></h1>
<h2><a class="header" href="#secure-enclave" id="secure-enclave">Secure Enclave</a></h2>
<p>The secure enclave is the component containing the secret cryptographic
material, and offering safe and secret high level interfaces to the rest of
the node.</p>
<h2><a class="header" href="#network" id="network">Network</a></h2>
<p>The node's network is 3 components:</p>
<ul>
<li>Intercommunication API (GRPC)</li>
<li>Public client API (REST)</li>
<li>Control client API (REST)</li>
</ul>
<p>More detailed information <a href="concepts/./network.html">here</a></p>
<h3><a class="header" href="#intercommunication-api-grpc" id="intercommunication-api-grpc">Intercommunication API (GRPC)</a></h3>
<p>This interface is a binary, efficient interface using the protobuf format and
GRPC standard. The protobuf files of types and interfaces are available in
the source code.</p>
<p>The interface is responsible to communicate with other node in the network:</p>
<ul>
<li>block sending and receiving</li>
<li>fragments (transaction, certificates) broadcast</li>
<li>peer2peer gossip</li>
</ul>
<h3><a class="header" href="#public-api-rest" id="public-api-rest">Public API REST</a></h3>
<p>This interface is for simple queries for clients like:</p>
<ul>
<li>Wallet Client &amp; Middleware</li>
<li>Analytics &amp; Debugging tools</li>
<li>Explorer</li>
</ul>
<p>it's recommended for this interface to not be opened to the public.</p>
<p>TODO: Add a high level overview of what it does</p>
<h3><a class="header" href="#control-api-rest" id="control-api-rest">Control API REST</a></h3>
<p>This interface is not finished, but is a restricted interface with ACL,
to be able to do maintenance tasks on the process:</p>
<ul>
<li>Shutdown</li>
<li>Load/Retire cryptographic material</li>
</ul>
<p>TODO: Detail the ACL/Security measure</p>
<p>Jörmungandr network capabilities are split into:</p>
<ol>
<li>the REST API, used for informational queries or control of the node;</li>
<li>the gRPC API for blockchain protocol exchange and participation;</li>
</ol>
<p>Here we will only review the gRPC API as the REST API is described in another
chapter: <a href="concepts/../quickstart/03_rest_api.html">go to the REST documentation</a></p>
<h1><a class="header" href="#the-protocol" id="the-protocol">The protocol</a></h1>
<p>The protocol is based on <a href="https://www.grpc.io"><code>gRPC</code></a> that combines commonly used protocols like HTTP/2 and RPC.
More precisely, Jörmungandr utilises.</p>
<p>This choice was made because  <a href="https://www.grpc.io"><code>gRPC</code></a> is already widely supported around the world because
of it's uitilization of standard protocols HTTP/2 which makes it much easier for Proxies and Firewalls to recognise
the protocol and permit the traffic.</p>
<h2><a class="header" href="#type-of-queries" id="type-of-queries">Type of queries</a></h2>
<p>The protocol allows you to send multiple types of messages between nodes:</p>
<ul>
<li>sync block to remote peer's <em>Last Block</em> (<code>tip</code>).</li>
<li>propose new fragments (new transactions, certificates, ...):
this is for the fragment propagation.</li>
<li>propose new blocks: for block propagation.</li>
</ul>
<p>There are other commands that optimise the communication and synchronisation
between nodes that will be documented here in the future.</p>
<p>Another type of messages is the <code>Gossip</code> message. These gossip messages allow Nodes to exchange
information (gossips) about other nodes on the network, allowing for peer
discovery.</p>
<h2><a class="header" href="#peer-to-peer" id="peer-to-peer">Peer to peer</a></h2>
<p>The peer 2 peer connections are established utilising multiple components:</p>
<ul>
<li>A multilayered topology (e.g. <a href="https://hal.inria.fr/hal-01555561/document">Poldercast</a>);</li>
<li>Gossiping for node discoverability;</li>
<li>Subscription mechanism for event propagation;</li>
<li>Security and countermeasures: (such as Topology Policy for scoring and/or
blacklisting nodes);</li>
</ul>
<h3><a class="header" href="#multilayered-topology" id="multilayered-topology">Multilayered topology</a></h3>
<p>As described in the <a href="https://hal.inria.fr/hal-01555561/document">Poldercast</a> paper, our network topology is
built on multiple layers that allow for granular control of it's behavior. In 
practice this means a node will have different groups of nodes that it connects to 
based on different algorithms, each of these groups are a subset of the whole 
known list of nodes.</p>
<p>In short we have:</p>
<ul>
<li>The rings layer selects a predecessor(s) and a successor(s) for each
topic (Fragment or Blocks);</li>
<li>The Vicinity layer will select nodes that have similar interests;</li>
<li>The Cyclon layer, will select nodes randomly.</li>
</ul>
<p>However, we keep the option open to remove some of these layers or to add new
ones, such as:</p>
<ul>
<li>A layer to allow privilege connections between stake pools;</li>
<li>A layer for the user's whitelist, a list of nodes the users considered
trustworthy and that we could use to check in the current state of the
network and verify the user's node is not within a long running fork;</li>
</ul>
<h3><a class="header" href="#gossiping" id="gossiping">Gossiping</a></h3>
<p>Gossiping is the process used for peer discovery. It allows two things:</p>
<ol>
<li>For any nodes to advertise themselves as discoverable;</li>
<li>To discover new nodes via exchanging a list of nodes (gossips);</li>
</ol>
<p>The gossips are selected by the different layers of the multilayered topology.
For the Poldercast modules, the gossips are selected just as in the paper.
Additional modules may select new nodes in the gossip list or may decide to
not add any new information.</p>
<h3><a class="header" href="#subscription-mechanism" id="subscription-mechanism">Subscription mechanism</a></h3>
<p>Based on the multilayered topology, the node will open multiplexed and
bi-directional connections (thanks to industry standard <a href="https://www.grpc.io"><code>gRPC</code></a>, this comes for
free). These bi-directional connections are used to propagate events such as:</p>
<ul>
<li>Gossiping events, when 2 nodes exchange gossips for peer discovery;</li>
<li>Fragment events, when a node wants to propagate a new fragment to other nodes;</li>
<li>Block events, when a node wants to propagate a new block creation event</li>
</ul>
<h3><a class="header" href="#security-and-countermeasures" id="security-and-countermeasures">Security and countermeasures</a></h3>
<p>In order to facilitate the handling of unreachable nodes or of misbehaving ones
we have built a node policy tooling. This is constructed via 2 mechanisms:
collecting connectivity statuses and blockchain status for each node. The policy
can then be tuned over the collected data to apply some parameters when
connecting to a given node, as well as banning nodes from our topology.</p>
<p>For each node, the following data is collected:</p>
<p>Connection statuses:</p>
<ul>
<li>The failed connection attempts and when it happened;</li>
<li>Latency</li>
<li>Last message used per topic item (last time a fragment has been received from
that node, last time a block has been received from that node…)</li>
</ul>
<p>Blockchain level info:</p>
<ul>
<li>Faults (e.g. trying to send an invalid block)</li>
<li>Contributions in the network</li>
<li>Their blockchain status (e.g. tips)</li>
</ul>
<h3><a class="header" href="#policy" id="policy">Policy</a></h3>
<p>The p2p policy provides some more fine control on how to handle nodes flagged
as not behaving as expected (see the list of data collected).</p>
<p>It currently works as a 3 levels: possible contact, quarantined, forgotten.
Each new gossip will create a new entry in the list of possible contact. Then
the policy, based on the logged data associated to this node, may decide to put
this node in quarantine for a certain amount of time. At the end of this time
the node may decide one of the following: keep it quarantined, make it a
possible contact again or forget about it.</p>
<p>The changes from one level to another is best effort only. Applying the policy
may be costly so the node applies the policy only on the node it is interested
about (a gossip update or when reporting an issue against a node). This
guarantees that the node does not spend too much time policing its database.
And it also makes sure that only the nodes of interest are up to date. However
it is possible for the node to choose, at a convenient time, to policy the whole
p2p database. This is not enforced by the protocol.</p>
<table><thead><tr><th align="left">Disposition</th><th align="left">Description</th></tr></thead><tbody>
<tr><td align="left">available</td><td align="left">Node is available for the p2p topology for view selection and gossips.</td></tr>
<tr><td align="left">quarantined</td><td align="left">Node is not available for the p2p topology for view selection or gossips. After a certain amount of time, if the node is still being gossiped about, it will be moved to available.</td></tr>
<tr><td align="left">forgotten</td><td align="left">A node forgotten is simply removed from the whole p2p database. However, if the node is still being gossiped about it will be added back as available and the process will start again.</td></tr>
</tbody></table>
<h1><a class="header" href="#quickstart" id="quickstart">Quickstart</a></h1>
<p>The rust node comes with tools and help in order to quickly start
a node and connect to the blockchain.</p>
<p>It is compatible with most platforms and it is pre-packaged for some
of them.</p>
<p>Here we will see how to install <code>jormungandr</code> and its helper <code>jcli</code>
and how to connect quickly to a given blockchain.</p>
<p>There are three posible ways you can start jormungandr.</p>
<h2><a class="header" href="#as-a-passive-node-in-an-existing-network" id="as-a-passive-node-in-an-existing-network">As a passive node in an existing network</a></h2>
<p>As described <a href="quickstart/./02_passive_node.html">here</a>.</p>
<p>The passive Node is the most common type of Node on the network. It can be used to download the blocks and broadcast transactions to peers, but it
doesn't have cryptographic materials or any mean to create blocks.
This type of nodes are mostly used for wallets, explorers or relays.</p>
<h2><a class="header" href="#as-a-node-generating-blocks-in-an-existing-network" id="as-a-node-generating-blocks-in-an-existing-network">As a node generating blocks in an existing network</a></h2>
<p>The network could be running either bft or genesis consensus. In the former case the node must have the private key of a registered as a slot leader, while for the latter the private keys of a registered stake pool are needed.</p>
<p>More information <a href="quickstart/./05_leader_candidate.html">here</a></p>
<h2><a class="header" href="#creating-your-own-network" id="creating-your-own-network">Creating your own network</a></h2>
<p>This is similar to the previous case, but configuring a genesis file is needed. Consult the <a href="quickstart/../advanced/introduction.html">Advanced section</a> for more information on this procedure.</p>
<p>The software is bundled with 2 different command line software:</p>
<ol>
<li><strong>jormungandr</strong>: the node;</li>
<li><strong>jcli</strong>: Jormungandr Command Line Interface, the helpers and primitives to run and interact with the node.</li>
</ol>
<h1><a class="header" href="#installation" id="installation">Installation</a></h1>
<h2><a class="header" href="#from-a-release" id="from-a-release">From a release</a></h2>
<p>This is the recommended method. Releases are all available
<a href="https://github.com/input-output-hk/jormungandr/releases">here</a>.</p>
<h2><a class="header" href="#from-source" id="from-source">From source</a></h2>
<p>Jormungandr's code source is available on
<a href="https://github.com/input-output-hk/jormungandr#how-to-install-from-sources">github</a>.
Follow the instructions to build the software from sources.</p>
<h1><a class="header" href="#help-and-auto-completion" id="help-and-auto-completion">Help and auto completion</a></h1>
<p>All commands come with usage help with the option <code>--help</code> or <code>-h</code>.</p>
<p>For <code>jcli</code>, it is possible to generate the auto completion with:</p>
<pre><code>jcli auto-completion bash ${HOME}/.bash_completion.d
</code></pre>
<p>Supported shells are: bash, fish, zsh, powershell and elvish.</p>
<p><strong>Note:</strong> 
Make sure <code>${HOME}/.bash_completion.d</code> directory previously exists on your HD.
In order to use auto completion you still need to:</p>
<pre><code>source ${HOME}/.bash_completion.d/jcli.bash
</code></pre>
<p>You can also put it in your <code>${HOME}/.bashrc</code>.</p>
<p>In order to start the node, you first need to gather the blockchain
information you need to connect to.</p>
<ol>
<li>the hash of the <strong>genesis block</strong> of the blockchain, this will be the source
of truth of the blockchain. It is 64 hexadecimal characters.</li>
<li>the <strong>trusted peers</strong> identifiers and access points.</li>
</ol>
<p>These information are essentials to start your node in a secure way.</p>
<p>The <strong>genesis block</strong> is the first block of the blockchain. It contains the
static parameters of the blockchain as well as the initial funds. Your node
will utilise the <strong>Hash</strong> to retrieve it from the other peers. It will also
allows the Node to verify the integrity of the downloaded <strong>genesis block</strong>.</p>
<p>The <strong>trusted peers</strong> are the nodes in the public network that your Node will
trust in order to initialise the Peer To Peer network.</p>
<h1><a class="header" href="#the-node-configuration" id="the-node-configuration">The node configuration</a></h1>
<p>Your node configuration file may look like the following:</p>
<p><strong>Note</strong></p>
<p>This config shouldn't work as it is, the ip address and port for the trusted peer should be those of an already running node.
Also, the public_address ('u.x.v.t') should be a valid address (you can use an internal one, eg: 127.0.0.1).
Furthermore, you need to have permission to write in the path specified by the storage config.</p>
<pre><code class="language-yaml">storage: &quot;/mnt/cardano/storage&quot;

rest:
  listen: &quot;127.0.0.1:8443&quot;

p2p:
  trusted_peers:
    - address: &quot;/ip4/104.24.28.11/tcp/8299&quot;
      id: ad24537cb009bedaebae3d247fecee9e14c57fe942e9bb0d
</code></pre>
<p>Description of the fields:</p>
<ul>
<li><code>storage</code>: (optional) Path to the storage. If omitted, the
blockchain is stored in memory only.</li>
<li><code>log</code>: (optional) Logging configuration:
<ul>
<li><code>level</code>: log messages minimum severity. If not configured anywhere, defaults to &quot;info&quot;.
Possible values: &quot;off&quot;, &quot;critical&quot;, &quot;error&quot;, &quot;warn&quot;, &quot;info&quot;, &quot;debug&quot;, &quot;trace&quot;.</li>
<li><code>format</code>: Log output format, <code>plain</code> or <code>json</code>.</li>
<li><code>output</code>: Log output destination. Possible values are:
<ul>
<li><code>stdout</code>: standard output</li>
<li><code>stderr</code>: standard error</li>
<li><code>syslog</code>: syslog (only available on Unix systems)</li>
<li><code>syslogudp</code>: remote syslog  (only available on Unix systems)
<ul>
<li><code>host</code>: address and port of a syslog server</li>
<li><code>hostname</code>: hostname to attach to syslog messages</li>
</ul>
</li>
<li><code>journald</code>: journald service (only available on Linux with systemd,
(if jormungandr is built with the <code>systemd</code> feature)</li>
<li><code>gelf</code>: Configuration fields for GELF (Graylog) network logging protocol
(if jormungandr is built with the <code>gelf</code> feature):
<ul>
<li><code>backend</code>: <em>hostname</em>:<em>port</em> of a GELF server</li>
<li><code>log_id</code>: identifier of the source of the log, for the <code>host</code> field
in the messages.</li>
</ul>
</li>
<li><code>file</code>: path to the log file.</li>
</ul>
</li>
</ul>
</li>
<li><code>rest</code>: (optional) Configuration of the REST endpoint.
<ul>
<li><code>listen</code>: <em>address</em>:<em>port</em> to listen for requests</li>
<li><code>tls</code>: (optional) enables TLS and disables plain HTTP if provided
<ul>
<li><code>cert_file</code>: path to server X.509 certificate chain file, must be PEM-encoded and contain at least 1 item</li>
<li><code>priv_key_file</code>: path to server private key file, must be PKCS8 with single PEM-encoded, unencrypted key</li>
</ul>
</li>
<li><code>cors</code>: (optional) CORS configuration, if not provided, CORS is disabled
<ul>
<li><code>allowed_origins</code>: (optional) allowed origins, if none provided, echos request origin</li>
<li><code>max_age_secs</code>: (optional) maximum CORS caching time in seconds, if none provided, caching is disabled</li>
</ul>
</li>
</ul>
</li>
<li><code>p2p</code>: P2P network settings
<ul>
<li><code>trusted_peers</code>: (optional) the list of nodes's <a href="https://github.com/multiformats/multiaddr">multiaddr</a> with their associated <code>public_id</code>
to connect to in order to bootstrap the P2P topology (and bootstrap our local blockchain);</li>
<li><code>public_id</code>: (optional) the node's public ID that will be used to
identify this node to the network.</li>
<li><code>public_address</code>: <a href="https://github.com/multiformats/multiaddr">multiaddr</a> string specifying address of the
P2P service. This is the public address that will be distributed to other
peers of the network that may find interest in participating to the
blockchain dissemination with the node.</li>
<li><code>listen_address</code>: (optional) <a href="https://github.com/multiformats/multiaddr">multiaddr</a> specifies the address the node
will listen to to receive p2p connection. Can be left empty and the node will listen
to whatever value was given to <code>public_address</code>.</li>
<li><code>topics_of_interest</code>: The dissemination topics this node is interested to hear about:
<ul>
<li><code>messages</code>: Transactions and other ledger entries.
Typical setting for a non-mining node: <code>low</code>. For a stakepool: <code>high</code>;</li>
<li><code>blocks</code>: Notifications about new blocks.
Typical setting for a non-mining node: <code>normal</code>. For a stakepool: <code>high</code>.</li>
</ul>
</li>
<li><code>max_connections</code>: The maximum number of simultaneous P2P connections
this node should maintain.</li>
</ul>
</li>
<li><code>explorer</code>: (optional) Explorer settings
<ul>
<li><code>enabled</code>: True or false</li>
</ul>
</li>
<li><code>no_blockchain_updates_warning_interval</code>: (optional, seconds) if no new blocks
were received after this period of time, the node will start sending you
warnings in the logs.</li>
</ul>
<h1><a class="header" href="#starting-the-node" id="starting-the-node">Starting the node</a></h1>
<pre><code>jormungandr --config config.yaml --genesis-block-hash 'abcdef987654321....'
</code></pre>
<p>The 'abcdef987654321....' part refers to the hash of the genesis, that should be given to you from one of the peers in the network you are connecting to.</p>
<p>In case you have the genesis file (for example, because you are creating the network) you can get this hash with jcli.</p>
<pre><code class="language-sh">cat block-0 | jcli genesis hash
</code></pre>
<p>or, in case you only have the yaml file</p>
<pre><code class="language-sh">cat genesis.yaml | jcli genesis encode | jcli genesis hash
</code></pre>
<p>It is possible to query the node via its REST Interface.</p>
<p>In the node configuration, you have set something like:</p>
<pre><code class="language-yaml"># ...

rest:
  listen: &quot;127.0.0.1:8443&quot;

#...
</code></pre>
<p>This is the REST endpoint to talk to the node, to query blocks or send transaction.</p>
<p>It is possible to query the node stats with the following end point:</p>
<pre><code>curl http://127.0.0.1:8443/api/v0/node/stats
</code></pre>
<p>The result may be:</p>
<pre><code class="language-json">{&quot;blockRecvCnt&quot;:120,&quot;txRecvCnt&quot;:92,&quot;uptime&quot;:245}
</code></pre>
<blockquote>
<p>THE REST API IS STILL UNDER DEVELOPMENT</p>
</blockquote>
<p>Please note that the end points and the results may change in the future.</p>
<p>To see the whole Node API documentation,
<a href="https://editor.swagger.io/?url=https://raw.githubusercontent.com/input-output-hk/jormungandr/master/doc/openapi.yaml">click here</a></p>
<h1><a class="header" href="#explorer-mode" id="explorer-mode">Explorer mode</a></h1>
<p>The node can be configured to work as a explorer. This consumes more resources, but makes it possible to query data otherwise not available.</p>
<h2><a class="header" href="#configuration" id="configuration">Configuration</a></h2>
<p>There is two ways of enabling the explorer api. It can either be done by passing the <code>--enable-explorer</code> flag on the start arguemnts or by the config file: </p>
<pre><code class="language-yaml">explorer:
    enabled: true
</code></pre>
<h4><a class="header" href="#cors" id="cors">CORS</a></h4>
<p>For configuring CORS the explorer API, this needs to be done on the REST section of the config, as documented <a href="quickstart/../configuration/network.html">here</a>.</p>
<h2><a class="header" href="#api" id="api">API</a></h2>
<p>A graphql interface can be used to query the explorer data, when enabled, two endpoints are available in the <a href="quickstart/03_rest_api.html">REST interface</a>: <code>/explorer/graphql</code> and <code>/explorer/graphiql</code> .</p>
<p>The first is the one that queries are made against, for example: </p>
<pre><code class="language-sh">curl \
    -X POST \
    -H &quot;Content-Type: application/json&quot; \
    --data '{'\
        '&quot;query&quot;: &quot;{'\
        '   status {'\
        '       latestBlock {'\
        '           chainLength'\
        '           id'\
        '           previousBlock {'\
        '               id'\
        '           }'\
        '       }'\
        '   }'\
        '}&quot;'\
    '}' \
  http://127.0.0.1:8443/explorer/graphql
</code></pre>
<p>While the second serves an in-browser graphql IDE that can be used to try queries interactively.</p>
<h1><a class="header" href="#how-to-start-a-node-as-a-leader-candidate" id="how-to-start-a-node-as-a-leader-candidate">How to start a node as a leader candidate</a></h1>
<h2><a class="header" href="#gathering-data" id="gathering-data">Gathering data</a></h2>
<p>Like in the passive node case, two things are needed to connect to an existing network</p>
<ol>
<li>the hash of the <strong>genesis block</strong> of the blockchain, this will be the source
of truth of the blockchain. It is 64 hexadecimal characters.</li>
<li>the <strong>trusted peers</strong> identifiers and access points.</li>
</ol>
<p>The node configuration could be the same as that for <a href="quickstart/./02_passive_node.html">running a passive node</a>.</p>
<p>There are some differences depending if you are connecting to a network running a genesis or bft consensus protocol.</p>
<h3><a class="header" href="#connecting-to-a-genesis-blockchain" id="connecting-to-a-genesis-blockchain">Connecting to a genesis blockchain</a></h3>
<h4><a class="header" href="#registering-a-stake-pool" id="registering-a-stake-pool">Registering a stake pool</a></h4>
<p>In order to be able to generate blocks in an existing genesis network, a <a href="quickstart/../stake_pool/registering_stake_pool.html">registered stake pool</a> is needed.</p>
<h4><a class="header" href="#creating-the-secrets-file" id="creating-the-secrets-file">Creating the secrets file</a></h4>
<p>Put the node id and private keys in a yaml file in the following way:</p>
<h5><a class="header" href="#example" id="example">Example</a></h5>
<p>filename: <em>node_secret.yaml</em></p>
<pre><code class="language-yaml">genesis:
  sig_key: Content of stake_pool_kes.prv file
  vrf_key: Content of stake_pool_vrf.prv file
  node_id: Content of stake_pool.id file
</code></pre>
<h4><a class="header" href="#starting-the-node-1" id="starting-the-node-1">Starting the node</a></h4>
<pre><code class="language-sh">jormungandr --genesis-block-hash asdf1234... --config config.yaml --secret node_secret.yaml
</code></pre>
<p><em>The 'asdf1234...' part should be the actual block0 hash of the network</em></p>
<h3><a class="header" href="#connecting-to-a-bft-blockchain" id="connecting-to-a-bft-blockchain">Connecting to a BFT blockchain</a></h3>
<p>In order to generate blocks, the node should be registered as a slot leader in the network and started in the following way.</p>
<h2><a class="header" href="#the-secret-file" id="the-secret-file">The secret file</a></h2>
<p>Put secret key in a yaml file, e.g. <code>node_secret.yaml</code> as follows:</p>
<pre><code class="language-yaml">bft:
 signing_key: ed25519_sk1kppercsk06k03yk4qgea....
</code></pre>
<p>where signing_key is a private key associated to the public id of a slot leader.</p>
<h3><a class="header" href="#starting-the-node-2" id="starting-the-node-2">Starting the node</a></h3>
<pre><code class="language-sh">jormungandr --genesis-block asdf1234... --config node.config --secret node_secret.yaml
</code></pre>
<p><em>The 'asdf1234...' part should be the actual block0 hash of the network</em></p>
<p>This chapter covers the node documentation, necessary to have a working system. It covers
the network, logging and storage parameters.</p>
<p>The node configuration uses the <a href="https://en.wikipedia.org/wiki/YAML">YAML</a> format.</p>
<p>This is an example of a configuration file:</p>
<pre><code class="language-YAML">storage: &quot;/tmp/storage&quot;
log:
  level: debug
  format: json
p2p:
  trusted_peers:
    - address: &quot;/ip4/104.24.28.11/tcp/8299&quot;
      id: 0ccc678e5c41fcffc7398fc5cc9c4e08ba88934fe6565305
    - address: &quot;/ip4/104.24.29.11/tcp/8299&quot;
      id: 328c71454e1ecdf88fc5e3763c74997e117f0dd84ef6eddf
  public_address: &quot;/ip4/127.0.0.1/tcp/8080&quot;
  public_id: ad24537cb009bedaebae3d247fecee9e14c57fe942e9bb0d
  topics_of_interest:
    messages: low
    blocks: normal
  allow_private_addresses: false
</code></pre>
<h2><a class="header" href="#advanced" id="advanced">advanced</a></h2>
<p>this is not a recommended settings as it may take memory and may trigger some latency:</p>
<p>If you want to record the reward distributions in a directory it is possible to set
the environment variable: <code>JORMUNGANDR_REWARD_DUMP_DIRECTORY=/PATH/TO/DIR/TO/WRITE/REWARD</code>.</p>
<p>If an error occur while dumping the reward, the node will <strong>panic</strong> with an appropriate
error message.</p>
<p>The following options are available in the log section:</p>
<ul>
<li><code>level</code>: log messages minimum severity. If not configured anywhere, defaults to &quot;info&quot;.
Possible values: &quot;off&quot;, &quot;critical&quot;, &quot;error&quot;, &quot;warn&quot;, &quot;info&quot;, &quot;debug&quot;, &quot;trace&quot;.</li>
<li><code>format</code>: log output format - <code>plain</code> or <code>json</code>.</li>
<li><code>output</code>: log output - <code>stdout</code>, <code>stderr</code>, <code>syslog</code> (Unix only),
or <code>journald</code> (Linux with systemd only, must be enabled during compilation).</li>
</ul>
<p>There's 2 differents network interfaces which are covered by their respective section:</p>
<pre><code class="language-yaml">rest:
   ...
p2p:
   ...
</code></pre>
<h2><a class="header" href="#rest-interface-configuration" id="rest-interface-configuration">REST interface configuration</a></h2>
<ul>
<li><code>listen</code>: listen address</li>
<li><code>tls</code>: (optional) enables TLS and disables plain HTTP if provided
<ul>
<li><code>cert_file</code>: path to server X.509 certificate chain file, must be PEM-encoded and contain at least 1 item</li>
<li><code>priv_key_file</code>: path to server private key file, must be PKCS8 with single PEM-encoded, unencrypted key</li>
</ul>
</li>
<li><code>cors</code>: (optional) CORS configuration, if not provided, CORS is disabled
<ul>
<li><code>allowed_origins</code>: (optional) allowed origins, if none provided, echos request origin</li>
<li><code>max_age_secs</code>: (optional) maximum CORS caching time in seconds, if none provided, caching is disabled</li>
</ul>
</li>
</ul>
<h3><a class="header" href="#configuring-tls" id="configuring-tls">Configuring TLS</a></h3>
<p>In order to enable TLS there must be provided certificate and private key files.</p>
<h4><a class="header" href="#example-generation-of-files-for-self-signed-tls" id="example-generation-of-files-for-self-signed-tls">Example generation of files for self-signed TLS</a></h4>
<p>Generate private key</p>
<pre><code class="language-bash">openssl genrsa -out priv.key 2048
</code></pre>
<p>Wrap private key in PKCS8</p>
<pre><code class="language-bash">openssl pkcs8 -topk8 -inform PEM -outform PEM -in priv.key -out priv.pk8 -nocrypt
</code></pre>
<p>Generate a self-signed certificate for private key</p>
<pre><code class="language-bash">openssl req -new -key priv.key -out cert_req.csr
openssl x509 -req -days 3650 -in cert_req.csr -signkey priv.key -out cert.crt
</code></pre>
<p>Use generated files in config</p>
<pre><code class="language-yaml">rest:
  tls:
    cert_file: cert.crt
    priv_key_file: priv.pk8
</code></pre>
<h2><a class="header" href="#p2p-configuration" id="p2p-configuration">P2P configuration</a></h2>
<ul>
<li><code>trusted_peers</code>: (optional) the list of nodes' <a href="https://github.com/multiformats/multiaddr">multiaddr</a> to connect to in order to
bootstrap the p2p topology (and bootstrap our local blockchain) with the associated <code>id</code> (24 bytes
in hexadecimal given by the trusted peers to allow initial connection to it).</li>
<li><code>public_address</code>: <a href="https://github.com/multiformats/multiaddr">multiaddr</a> the address to listen from and accept connection
from. This is the public address that will be distributed to other peers
of the network that may find interest into participating to the blockchain
dissemination with the node.  Currently only TCP is supported.</li>
<li><code>public_id</code>: (optional) This is a static identifier, 24 bytes encoded in hexadecimal. They are used
to bootstrap the connection to the node if the node introduce itself as a trusted peer.
<strong>Most of the user don't need to set this value</strong> and in fact we are working toward potentially
removing the need for this value.</li>
<li><code>listen_address</code>: (optional) <a href="https://github.com/multiformats/multiaddr">multiaddr</a> specifies the address the node
will listen to to receive p2p connection. Can be left empty and the node will listen
to whatever value was given to <code>public_address</code>.</li>
<li><code>topics_of_interest</code>: (optional) the different topics we are interested to hear about:
<ul>
<li><code>messages</code>: notify other peers this node is interested about Transactions
typical setting for a non mining node: <code>&quot;low&quot;</code>. For a stakepool: <code>&quot;high&quot;</code>;</li>
<li><code>blocks</code>: notify other peers this node is interested about new Blocs.
typical settings for a non mining node: <code>&quot;normal&quot;</code>. For a stakepool: <code>&quot;high&quot;</code>.</li>
</ul>
</li>
<li><code>max_connections</code>: the maximum number of P2P connections this node should
maintain. If not specified, an internal limit is used by default <code>[default: 256]</code></li>
<li><code>max_connections_threshold</code>: this is the number of available connections to keep
reserved for actually active connections. The node will apply this GC operation
from time to time if the <code>max_connections - max_connections_threshold</code> is reached.
<code>[default: 64]</code></li>
<li><code>policy</code>: (optional) set the setting for the policy module
<ul>
<li><code>quarantine_duration</code> set the time to leave a node in quarantine before allowing
it back (or not) into the fold.
It is recommended to leave the default value <code>[default: 30min]</code>.</li>
</ul>
</li>
<li><code>max_unreachable_nodes_to_connect_per_event</code>: (optional) set the maximum number of unreachable nodes
to contact at a time for every new notification.
Every time a new propagation event is triggered, the node will select
randomly a certain amount of unreachable nodes to connect to in addition
to the one selected by other p2p topology layer <code>[default: 20]</code></li>
<li><code>gossip_interval</code>: (optional) interval to start gossiping with new nodes,
changing the value will affect the bandwidth. The more often the node will
gossip the more bandwidth the node will need. The less often the node gossips
the less good the resilience to node churn. <code>[default: 10s]</code></li>
<li><code>topology_force_reset_interval</code>: (optional) If this value is set, it will
trigger a force reset of the topology layers. The default is to not do
force the reset. It is recommended to let the protocol handle it.</li>
</ul>
<h3><a class="header" href="#the-trusted-peers" id="the-trusted-peers">The trusted peers</a></h3>
<p>The trusted peers is a concept that is not fully implemented yet. One of the key element
for now is that this is the first node any node tries to connect in order to meet new nodes.
Right now, as far as we know, only one of them is needed. IOHK provides a few others for
redundancy.</p>
<h3><a class="header" href="#setting-the-public_id" id="setting-the-public_id">Setting the <code>public_id</code></a></h3>
<p>This is needed to advertise your node as a trusted peer.
If not set, the node will generate a random ID, which is fine for a regular user.
You can generate a public id with <strong>openssl</strong>, for example: <code>openssl rand -hex 24</code></p>
<h3><a class="header" href="#topics_of_interest" id="topics_of_interest"><code>topics_of_interest</code></a></h3>
<p>This is optional an optional value to set. The default is:</p>
<pre><code>messages: low
blocks: normal
</code></pre>
<p>These value makes sense for most of the users that are not running stake pools or
that are not even publicly reachable.</p>
<p>However for a publicly reachable node, the recommended setting would be:</p>
<pre><code>messages: normal
blocks: normal
</code></pre>
<p>and for a stake pool</p>
<pre><code>messages: high
blocks: high
</code></pre>
<p>When running an active node (BFT leader or stake pool) it is interesting to be
able to make choices on how to manage the pending transactions: how long to keep
them, how to prioritize them etc.</p>
<p>The <code>mempool</code> field in your node config file is not mandatory, by default it is set
as follow:</p>
<pre><code class="language-yaml">mempool:
    pool_max_entries: 10000
    fragment_ttl: 30m
    log_max_entries: 100000
    log_ttl: 1h
    garbage_collection_interval: 15m
</code></pre>
<ul>
<li><code>pool_max_entries</code>: (optional, default is 10000). Set a maximum size of the mempool</li>
<li><code>fragment_ttl</code> describes for how long the node shall keep a fragment (a <em>transaction</em>)
pending in the pool before being discarded;</li>
<li><code>log_max_entries</code>: (optional, default is 100000). Set a maximum size of fragment logs</li>
<li><code>log_ttl</code> describes for how long the node will keep logs of pending/accepted/rejected
fragments in the pool; This is link to the data you receives from the REST fragment
logs end point;</li>
<li><code>garbage_collection_interval</code> describes the interval between 2 garbage collection
runs: i.e. when the node removes item (fragments or logs) that have timed out. </li>
</ul>
<p>The <code>leadership</code> field in your node config file is not mandatory, by default it is set
as follow:</p>
<pre><code class="language-yaml">leadership:
    log_ttl: 1h
    garbage_collection_interval: 15m
</code></pre>
<ul>
<li><code>log_ttl</code> describes for how long the node will keep logs of leader events.
This is link to the data you receives from the REST leadership logs end point;</li>
<li><code>garbage_collection_interval</code> describes the interval between 2 garbage collection
runs: i.e. when the node removes item logs that have timed out</li>
</ul>
<h1><a class="header" href="#jcli" id="jcli">jcli</a></h1>
<p>This is the node command line helper. It is mostly meant for developers and
stake pool operators. It allows offline operations:</p>
<ul>
<li>generating cryptographic materials for the wallets and stake pools;</li>
<li>creating addresses, transactions and certificates;</li>
<li>prepare a new blockchain</li>
</ul>
<p>and it allows simple interactions with the node:</p>
<ul>
<li>query stats;</li>
<li>send transactions and certificates;</li>
<li>get raw blocks and UTxOs.</li>
</ul>
<h1><a class="header" href="#cryptographic-keys" id="cryptographic-keys">cryptographic keys</a></h1>
<p>There are multiple type of key for multiple use cases.</p>
<table><thead><tr><th align="center">type</th><th align="left">usage</th></tr></thead><tbody>
<tr><td align="center"><code>Ed25519</code></td><td align="left">Signing algorithm for Ed25519 algorithm</td></tr>
<tr><td align="center"><code>Ed25519Bip32</code></td><td align="left">Related to the HDWallet, Ed25519 Extended with chain code for derivation derivation</td></tr>
<tr><td align="center"><code>Ed25519Extended</code></td><td align="left">Related to <code>Ed25519Bip32</code> without the chain code</td></tr>
<tr><td align="center"><code>SumEd25519_12</code></td><td align="left">For stake pool, necessary for the KES</td></tr>
<tr><td align="center"><code>Curve25519_2HashDH</code></td><td align="left">For stake pool, necessary for the VRF</td></tr>
</tbody></table>
<p>There is a command line parameter to generate this keys:</p>
<pre><code>$ jcli key generate --type=Ed25519
ed25519_sk1cvac48ddf2rpk9na94nv2zqhj74j0j8a99q33gsqdvalkrz6ar9srnhvmt
</code></pre>
<p>and to extract the associated public key:</p>
<pre><code>$ echo ed25519_sk1cvac48ddf2rpk9na94nv2zqhj74j0j8a99q33gsqdvalkrz6ar9srnhvmt | jcli key to-public
ed25519_pk1z2ffur59cq7t806nc9y2g64wa60pg5m6e9cmrhxz9phppaxk5d4sn8nsqg
</code></pre>
<h2><a class="header" href="#signing-data" id="signing-data">Signing data</a></h2>
<p>Sign data with private key. Supported key formats are: ed25519, ed25519bip32, ed25519extended and
sumed25519_12.</p>
<pre><code>jcli key sign &lt;options&gt; &lt;data&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>--secret-key &lt;secret_key&gt; - path to file with bech32-encoded secret key</li>
<li>-o, --output <output> - path to file to write signature into, if no value is passed,
standard output will be used</li>
</ul>
<p><data> - path to file with data to sign, if no value is passed, standard input will be used</p>
<h2><a class="header" href="#verifying-signed-data" id="verifying-signed-data">Verifying signed data</a></h2>
<p>Verify signed data with public key. Supported key formats are: ed25519, ed25519bip32 and
sumed25519_12.</p>
<pre><code>jcli key verify &lt;options&gt; &lt;data&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>--public-key &lt;public_key&gt; - path to file with bech32-encoded public key</li>
<li>--signature <signature> - path to file with signature</li>
</ul>
<p><data> - path to file with data to sign, if no value is passed, standard input will be used</p>
<h1><a class="header" href="#address" id="address">Address</a></h1>
<p>Jormungandr comes with a separate CLI to create and manipulate addresses.</p>
<p>This is useful for creating addresses from their components in the CLI,
for debugging addresses and for testing.</p>
<h2><a class="header" href="#display-address-info" id="display-address-info">Display address info</a></h2>
<p>To display an address and verify it is in a valid format you can utilise:</p>
<pre><code>$ jcli address info ta1svy0mwwm7mdwcuj308aapjw6ra4c3e6cygd0f333nvtjzxg8ahdvxlswdf0
discrimination: testing
public key: ed25519e_pk1pr7mnklkmtk8y5tel0gvnksldwywwkpzrt6vvvvmzus3jpldmtpsx9rnmx
</code></pre>
<p>or for example:</p>
<pre><code>$ jcli address \
    info \
    ca1qsy0mwwm7mdwcuj308aapjw6ra4c3e6cygd0f333nvtjzxg8ahdvxz8ah8dldkhvwfghn77se8dp76uguavzyxh5cccek9epryr7mkkr8n7kgx
discrimination: production
public key: ed25519_pk1pr7mnklkmtk8y5tel0gvnksldwywwkpzrt6vvvvmzus3jpldmtpsx9rnmx
group key:  ed25519_pk1pr7mnklkmtk8y5tel0gvnksldwywwkpzrt6vvvvmzus3jpldmtpsx9rnmx
</code></pre>
<h2><a class="header" href="#creating-an-address" id="creating-an-address">Creating an address</a></h2>
<p>Each command following allows to create addresses for production and testing
chains. For chains, where the discrimination is <code>testing</code>, you need to
use the <code>--testing</code> flag.</p>
<p>There's 3 types of addresses:</p>
<ul>
<li>Single address : A simple spending key. This doesn't have any stake in the system</li>
<li>Grouped address : A spending key attached to an account key. The stake is automatically</li>
<li>Account address : An account key. The account is its own stake</li>
</ul>
<h3><a class="header" href="#address-for-utxo" id="address-for-utxo">Address for UTxO</a></h3>
<p>You can create a single address (non-staked) using the spending public key for
this address utilising the following command:</p>
<pre><code>$ jcli address \
    single ed25519e_pk1jnlhwdgzv3c9frknyv7twsv82su26qm30yfpdmvkzyjsdgw80mfqduaean
ca1qw207ae4qfj8q4yw6v3ned6psa2r3tgrw9u3y9hdjcgj2p4pcaldyukyka8
</code></pre>
<p>To add the staking information and make a group address, simply add the account
public key as a second parameter of the command:</p>
<pre><code>$ jcli address \
    single \
    ed25519_pk1fxvudq6j7mfxvgk986t5f3f258sdtw89v4n3kr0fm6mpe4apxl4q0vhp3k \
    ed25519_pk1as03wxmy2426ceh8nurplvjmauwpwlcz7ycwj7xtl9gmx9u5gkqscc5ylx
ca1q3yen35r2tmdye3zc5lfw3x992s7p4dcu4jkwxcda80tv8xh5ym74mqlzudkg42443nw08cxr7e9hmcuzals9ufsa9uvh723kvteg3vpvrcxcq
</code></pre>
<h3><a class="header" href="#address-for-account" id="address-for-account">Address for Account</a></h3>
<p>To create an account address you need the account public key and run:</p>
<pre><code>$ jcli address \
    account ed25519_pk1c4yq3hflulynn8fef0hdq92579n3c49qxljasrl9dnuvcksk84gs9sqvc2
ca1qhz5szxa8lnujwva8997a5q42nckw8z55qm7tkq0u4k03nz6zc74ze780qe
</code></pre>
<h3><a class="header" href="#changing-the-address-prefix" id="changing-the-address-prefix">changing the address prefix</a></h3>
<p>You can decide to change the address prefix, allowing you to provide more
enriched data to the user. However, this prefix is not forwarded to the node,
it is only for UI/UX.</p>
<pre><code>$ jcli address \
    account \
    --prefix=address_ \
    ed25519_pk1yx6q8rsndawfx8hjzwntfs2h2c37v5g6edv67hmcxvrmxfjdz9wqeejchg
address_1q5smgquwzdh4eyc77gf6ddxp2atz8ej3rt94nt6l0qes0vexf5g4cw68kdx
</code></pre>
<h1><a class="header" href="#transaction-1" id="transaction-1">Transaction</a></h1>
<p>Tooling for offline transaction creation and signing.</p>
<pre><code class="language-sh">jcli transaction
</code></pre>
<p>Those familiar with <a href="http://github.com/input-output-hk/cardano-cli"><code>cardano-cli</code></a>
transaction builder will see resemblance in <code>jcli transaction</code>.</p>
<p>There is a couple of commands that can be used to:</p>
<ol>
<li>prepare a transaction:
<ul>
<li><code>new</code> create a new empty transaction;</li>
<li><code>add-input</code></li>
<li><code>add-account</code></li>
<li><code>add-output</code></li>
</ul>
</li>
<li><code>finalize</code> the transaction for signing:</li>
<li>create witnesses and add the witnesses:
<ul>
<li><code>make-witness</code></li>
<li><code>add-witness</code></li>
</ul>
</li>
<li><code>seal</code> the transaction, ready to send to the blockchain</li>
<li><code>auth</code> the transaction, if it contains a certificate</li>
</ol>
<p>There are also functions to help decode and display the
content information of a transaction:</p>
<ul>
<li><code>info</code> displays summary of transaction being constructed</li>
<li><code>data-for-witness</code> get the data to sign from a given transaction</li>
<li><code>fragment-id</code> get the <strong>Fragment ID</strong> from a transaction in <em>sealed</em> state</li>
<li><code>to-message</code> to get the hexadecimal encoded message, ready to send with <code>cli rest message</code></li>
</ul>
<p><strong>DEPRECATED</strong>:</p>
<ul>
<li><code>id</code> get the data to sign from a given transaction (use <code>data-for-witness</code> instead)</li>
</ul>
<h2><a class="header" href="#transaction-info" id="transaction-info">Transaction info</a></h2>
<p>On every stage of building a transaction user can display its summary</p>
<pre><code class="language-sh">jcli transaction info &lt;options&gt;
</code></pre>
<p>The options are:</p>
<ul>
<li>
<p><code>--prefix &lt;address-prefix&gt;</code>       - set the address prefix to use when displaying the addresses (default: ca)</p>
</li>
<li>
<p><code>--fee-certificate &lt;certificate&gt;</code> - fee per certificate (default: 0)</p>
</li>
<li>
<p><code>--fee-coefficient &lt;coefficient&gt;</code> - fee per every input and output (default: 0)</p>
</li>
<li>
<p><code>--fee-constant &lt;constant&gt;</code>       - fee per transaction (default: 0)</p>
</li>
<li>
<p><code>--output-format &lt;format&gt;</code>        - Format of output data. Possible values: json, yaml.
Any other value is treated as a custom format using values from output data structure.
Syntax is Go text template: https://golang.org/pkg/text/template/. (default: yaml)</p>
</li>
<li>
<p><code>--output &lt;output&gt;</code>               - write the info in the given file or print it to the standard output</p>
</li>
<li>
<p><code>--staging &lt;staging-file&gt;</code>        - place where the transaction is going to be save during its staging phase.
If a file is given, the transaction will be read from this file and modification will be written into this same file.
If no file is given, the transaction will be read from the standard input and will be rendered in the standard output</p>
</li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
balance: 40         # transaction balance or how much input is not spent
fee: 60             # total fee for transaction
input: 200          # total input of transaction
inputs:             # list of transaction inputs, each can be of either &quot;utxo&quot; or &quot;account&quot; kind
  - index: 4        # index of transaction output
    kind: utxo      # constant value, signals that UTxO is used
                    # hex-encoded ID of transaction
    txid: 543326b2739356ab6d14624a536ca696f1020498b36456b7fdfe8344c084bfcf
    value: 130      # value of transaction output
  -                 # hex-encoded account address
    account: 3fd45a64ae5a3b9c35e37114baa099b8b01285f7d74b371597af22d5ff393d9f
    kind: account   # constant value, signals that account is used
    value: 70       # value taken from account
num_inputs: 1       # total number of inputs of transaction
num_outputs: 1      # total number of outputs of transaction
num_witnesses: 1    # total number of witnesses of transaction
output: 100         # total output of transaction
outputs:            # list of transaction outputs
  -                 # bech32-encoded address
    address: ca1swedukl830v26m8hl7e5dzrjp77yctuz79a68r8jl2l79qnpu3uwz0kg8az
    value: 100      # value sent to address
                    # hex-encoded transaction hash, when transaction is complete, it's also its ID
sign_data_hash: 26be0b8bd7e34efffb769864f00d7c4aab968760f663a7e0b3ce213c4b21651b
status: sealed      # transaction status, can be &quot;balancing&quot;, &quot;finalizing&quot;, &quot;sealed&quot; or &quot;authed&quot;
</code></pre>
<h1><a class="header" href="#examples" id="examples">Examples</a></h1>
<p>The following example focuses on using an utxo as input, the few differences when transfering from an account will be pointed out when necessary.
There is also a script <a href="https://github.com/input-output-hk/jormungandr/blob/master/scripts/send-transaction">here</a> to send a transaction from a faucet account to a specific address which could be used as a reference.</p>
<p>Let's use the following utxo as input and transfer 50 lovelaces to the destination address</p>
<h2><a class="header" href="#input-utxo" id="input-utxo">Input utxo</a></h2>
<table><thead><tr><th>Field</th><th align="center">Value</th></tr></thead><tbody>
<tr><td>UTXO's transaction ID</td><td align="center">55762218e5737603e6d27d36c8aacf8fcd16406e820361a8ac65c7dc663f6d1c</td></tr>
<tr><td>UTXO's output index</td><td align="center">0</td></tr>
<tr><td>associated address</td><td align="center">ca1q09u0nxmnfg7af8ycuygx57p5xgzmnmgtaeer9xun7hly6mlgt3pjyknplu</td></tr>
<tr><td>associated value</td><td align="center">100</td></tr>
</tbody></table>
<h2><a class="header" href="#destination-address" id="destination-address">Destination address</a></h2>
<p><strong>address</strong>: ca1qvnr5pvt9e5p009strshxndrsx5etcentslp2rwj6csm8sfk24a2wlqtdj6</p>
<h2><a class="header" href="#create-a-staging-area" id="create-a-staging-area">Create a staging area</a></h2>
<pre><code class="language-sh">jcli transaction new --staging tx
</code></pre>
<h2><a class="header" href="#add-input" id="add-input">Add input</a></h2>
<p>For the input, we need to reference the uxto with the <strong>UTXO's transaction ID</strong> and <strong>UTXO'S output index</strong> fields and we need to specify how much coins are there with the <strong>associated value</strong> field.</p>
<h3><a class="header" href="#example---utxo-address-as-input" id="example---utxo-address-as-input">Example - UTXO address as Input</a></h3>
<pre><code class="language-sh">jcli transaction add-input 55762218e5737603e6d27d36c8aacf8fcd16406e820361a8ac65c7dc663f6d1c 0 100 --staging tx
</code></pre>
<h3><a class="header" href="#example---account-address-as-input" id="example---account-address-as-input">Example - Account address as Input</a></h3>
<p>If the input is an account, the command is slightly different</p>
<pre><code class="language-sh">jcli transaction add-account account_address account_funds --staging tx
</code></pre>
<h2><a class="header" href="#add-output" id="add-output">Add output</a></h2>
<p>For the output, we need the address we want to transfer to, and the amount.</p>
<pre><code class="language-sh">jcli transaction add-output ca1qvnr5pvt9e5p009strshxndrsx5etcentslp2rwj6csm8sfk24a2wlqtdj6 50 --staging tx
</code></pre>
<h2><a class="header" href="#add-fee-and-change-address" id="add-fee-and-change-address">Add fee and change address</a></h2>
<p>We want to get the change in the same address that we are sending from (the <em>associated address</em> of the utxo). We also specify how to compute the fees.
You can leave out the <code>--fee-constant 5 --fee-coefficient 2</code> part if those are both 0.</p>
<pre><code class="language-sh">jcli transaction finalize ca1q09u0nxmnfg7af8ycuygx57p5xgzmnmgtaeer9xun7hly6mlgt3pjyknplu --fee-constant 5 --fee-coefficient 2 --staging tx
</code></pre>
<p>Now, if you run</p>
<pre><code class="language-sh">jcli transaction info --fee-constant 5 --fee-coefficient 2 --staging tx
</code></pre>
<p>You should see something like this</p>
<pre><code class="language-yaml">---
balance: 0
fee: 11
input: 100
inputs:
  - index: 0
    kind: utxo
    txid: 55762218e5737603e6d27d36c8aacf8fcd16406e820361a8ac65c7dc663f6d1c
    value: 100
num_inputs: 1
num_outputs: 2
num_witnesses: 0
output: 89
outputs:
  - address: ca1qvnr5pvt9e5p009strshxndrsx5etcentslp2rwj6csm8sfk24a2wlqtdj6
    value: 50
  - address: ca1q09u0nxmnfg7af8ycuygx57p5xgzmnmgtaeer9xun7hly6mlgt3pjyknplu
    value: 39
sign_data_hash: 0df39a87d3f18a188b40ba8c203f85f37af665df229fb4821e477f6998864273
status: finalizing
</code></pre>
<h2><a class="header" href="#sign-the-transaction" id="sign-the-transaction">Sign the transaction</a></h2>
<h3><a class="header" href="#make-witness" id="make-witness">Make witness</a></h3>
<p>For signing the transaction, you need:</p>
<ul>
<li>the hash of the genesis block of the network you are connected to.</li>
<li>the private key associated with the input address (the one that's in the utxos).</li>
<li>the hash of the transaction, that can be retrieved in two ways:
<ol>
<li><code>sign_data_hash</code> value from <code>jcli transaction info --staging tx</code>  or</li>
<li><code>jcli transaction data-for-witness --staging tx</code></li>
</ol>
</li>
</ul>
<p>The genesis' hash is needed for ensuring that the transaction cannot be re-used in another blockchain and for security concerns on offline transaction signing, as we are signing the transaction for the specific blockchain started by this block0 hash.</p>
<p>First we need to get the hash of the transaction we are going to sign.</p>
<pre><code class="language-sh">jcli transaction data-for-witness --staging tx
</code></pre>
<p>You should see something like this (the value may be different since it depends on the input/output data)</p>
<pre><code class="language-sh">0df39a87d3f18a188b40ba8c203f85f37af665df229fb4821e477f6998864273
</code></pre>
<p>The following command takes the private key in the <em>key.prv</em> file and creates a witness in a file named <em>witness</em> in the current directory.</p>
<pre><code class="language-sh">jcli transaction make-witness --genesis-block-hash abcdef987654321... --type utxo 0df39a87d3f18a188b40ba8c203f85f37af665df229fb4821e477f6998864273 witness key.prv
</code></pre>
<hr />
<h4><a class="header" href="#account-input" id="account-input">Account input</a></h4>
<p>When using an account as input, the command takes <code>account</code> as the type and an additional parameter: <code>--account-spending-counter</code>, that should be increased every time the account is used as input.</p>
<p>e.g.</p>
<pre><code class="language-sh">jcli transaction make-witness --genesis-block-hash abcdef987654321... --type account --account-spending-counter 0 0df39a87d3f18a188b40ba8c203f85f37af665df229fb4821e477f6998864273 witness key.prv
</code></pre>
<h3><a class="header" href="#add-witness" id="add-witness">Add witness</a></h3>
<pre><code class="language-sh">jcli transaction add-witness witness --staging tx
</code></pre>
<h2><a class="header" href="#send-the-transaction" id="send-the-transaction">Send the transaction</a></h2>
<pre><code class="language-sh">jcli transaction seal --staging tx
</code></pre>
<pre><code class="language-sh">jcli transaction to-message --staging tx &gt; txmsg
</code></pre>
<p>Send it using the rest api</p>
<pre><code class="language-sh">jcli rest v0 message post -f txmsg --host http://127.0.0.1:8443/api
</code></pre>
<p>You should get some data back referring to the TransactionID (also known as FragmentID)</p>
<pre><code class="language-sh">d6ef0b2148a51ed64531efc17978a527fd2d2584da1e344a35ad12bf5460a7e2
</code></pre>
<h2><a class="header" href="#checking-if-the-transaction-was-accepted" id="checking-if-the-transaction-was-accepted">Checking if the transaction was accepted</a></h2>
<p>You can check if the transaction was accepted by checking the node logs, for example, if the transaction is accepted</p>
<p><code>jcli rest v0 message logs -h http://127.0.0.1:8443/api</code></p>
<pre><code class="language-plaintext">---
- fragment_id: d6ef0b2148a51ed64531efc17978a527fd2d2584da1e344a35ad12bf5460a7e2
  last_updated_at: &quot;2019-06-11T15:38:17.070162114Z&quot;
  received_at: &quot;2019-06-11T15:37:09.469101162Z&quot;
  received_from: Rest
  status:
    InABlock:
      date: &quot;4.707&quot;
      block: &quot;d9040ca57e513a36ecd3bb54207dfcd10682200929cad6ada46b521417964174&quot;
</code></pre>
<p>Where the <strong>InABlock</strong> status means that the transaction was accepted in the block with date &quot;4.707&quot;
and for block <code>d9040ca57e513a36ecd3bb54207dfcd10682200929cad6ada46b521417964174</code>.</p>
<p>The status here could also be:</p>
<p><strong>Pending</strong>: if the transaction is received and is pending being added in the blockchain (or rejected).</p>
<p>or</p>
<p><strong>Rejected</strong>: with an attached message of the reason the transaction was rejected.</p>
<h1><a class="header" href="#certificate" id="certificate">Certificate</a></h1>
<p>Tooling for offline transaction creation</p>
<h2><a class="header" href="#building-stake-pool-registration-certificate" id="building-stake-pool-registration-certificate">Building stake pool registration certificate</a></h2>
<p>Builds a stake pool registration certificate.</p>
<pre><code class="language-sh">jcli certificate new stake-pool-registration \
    --vrf-key &lt;vrf-public-key&gt; \
    --kes-key &lt;kes-public-key&gt; \
    --start-validity &lt;seconds-since-start&gt; \
    --management-threshold &lt;THRESHOLD&gt; \
    --owner &lt;owner-public-key&gt; \
    [--operator &lt;operator-public-key&gt;] \
    [&lt;output-file&gt;]
</code></pre>
<p>Where:</p>
<ul>
<li><code>--operator &lt;operator-public-key&gt;</code> - <em>optional</em>, public key of the operator(s) of the pool.</li>
<li><code>output-file</code>                      - <em>optional</em>, write the output to the given file or print it to the standard output if not defined</li>
</ul>
<h2><a class="header" href="#building-stake-pool-delegation-certificate" id="building-stake-pool-delegation-certificate">Building stake pool delegation certificate</a></h2>
<p>Builds a stake pool delegation certificate.</p>
<pre><code class="language-sh">jcli certificate new stake-delegation &lt;STAKE_KEY&gt; &lt;STAKE_POOL_IDS&gt; [--output &lt;output-file&gt;]
</code></pre>
<p>Where:</p>
<ul>
<li><code>-o, --output &lt;output-file&gt;</code> - <em>optional</em>, write the output to the given file or print it to the standard output if not defined</li>
<li><code>&lt;STAKE_KEY&gt;</code>                - the public key used in the stake key registration</li>
<li><code>&lt;STAKE_POOL_IDS&gt;...</code>        - hex-encoded stake pool IDs and their numeric weights in format <strong>&quot;pool_id:weight&quot;</strong>.
If <em>weight</em> is not provided, <em>it defaults to 1</em>.</li>
</ul>
<h1><a class="header" href="#genesis" id="genesis">Genesis</a></h1>
<p>Tooling for working with a genesis file</p>
<h1><a class="header" href="#usage" id="usage">Usage</a></h1>
<pre><code class="language-sh">jcli genesis [subcommand]
</code></pre>
<h2><a class="header" href="#subcommands" id="subcommands">Subcommands</a></h2>
<ul>
<li>decode: Print the YAML file corresponding to an encoded genesis block.</li>
<li>encode: Create the genesis block of the blockchain from a given yaml file.</li>
<li>hash: Print the block hash of the genesis </li>
<li>init: Create a default Genesis file with appropriate documentation to help creating the YAML file</li>
<li>help</li>
</ul>
<h2><a class="header" href="#examples-1" id="examples-1">Examples</a></h2>
<h3><a class="header" href="#encode-a-genesis-file" id="encode-a-genesis-file">Encode a genesis file</a></h3>
<pre><code class="language-sh">jcli genesis encode --input genesis.yaml --output block-0.bin
</code></pre>
<p>or equivantely</p>
<pre><code class="language-sh">cat genesis.yaml | jcli genesis encode &gt; block-0.bin
</code></pre>
<h3><a class="header" href="#get-the-hash-of-an-encoded-genesis-file" id="get-the-hash-of-an-encoded-genesis-file">Get the hash of an encoded genesis file</a></h3>
<pre><code class="language-sh">jcli genesis hash --input block-0.bin
</code></pre>
<h1><a class="header" href="#rest" id="rest">REST</a></h1>
<p>Jormungandr comes with a CLI client for manual communication with nodes over HTTP.</p>
<h2><a class="header" href="#conventions" id="conventions">Conventions</a></h2>
<p>Many CLI commands have common arguments:</p>
<ul>
<li><code>-h &lt;addr&gt;</code> or <code>--host &lt;addr&gt;</code> - Node API address. Must always have <code>http://</code> or
<code>https://</code> prefix. E.g. <code>-h http://127.0.0.1</code>, <code>--host https://node.com:8443/cardano/api</code></li>
<li><code>--debug</code> - Print additional debug information to stderr.
The output format is intentionally undocumented and unstable</li>
<li><code>--output-format &lt;format&gt;</code> - Format of output data. Possible values: json, yaml, default yaml.
Any other value is treated as a custom format using values from output data structure.
Syntax is Go text template: https://golang.org/pkg/text/template/.</li>
</ul>
<h2><a class="header" href="#node-stats" id="node-stats">Node stats</a></h2>
<p>Fetches node stats</p>
<pre><code>jcli rest v0 node stats get &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
# Number of blocks received by node
blockRecvCnt: 1102
# Size in bytes of all transactions in last block
lastBlockContentSize: 484
# The Epoch and slot Number of the block (optional)
lastBlockDate: &quot;20.29&quot;
# Sum of all fee values in all transactions in last block
lastBlockFees: 534
# The block hash, it's unique identifier in the blockchain (optional)
lastBlockHash: b9597b45a402451540e6aabb58f2ee4d65c67953b338e04c52c00aa0886bd1f0
# The block number, in order, since the block0 (optional)
lastBlockHeight: 202901
# Sum of all input values in all transactions in last block
lastBlockSum: 51604
# When last block was created, not set if none was created yet (optional)
lastBlockTime: 2019-08-12T11:20:52.316544007+00:00
# Number of transactions in last block
lastBlockTx: 2
# State of the node
state: Running
# Number of transactions received by node
txRecvCnt: 5440
# Node uptime in seconds
uptime: 20032
# Node app version
version: jormungandr 0.8.0-rc4-67477249
</code></pre>
<h2><a class="header" href="#get-utxo" id="get-utxo">Get UTxO</a></h2>
<p>Fetches UTxO details</p>
<pre><code>jcli rest v0 utxo &lt;fragment-id&gt; &lt;output-index&gt; get &lt;options&gt;
</code></pre>
<p><fragment-id>   - hex-encoded ID of the transaction fragment
<output-index>  - index of the transaction output</p>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
# UTxO owner address
address: ca1svs0mwkfky9htpam576mc93mee5709khre8dgnqslj6y3p5f77s5gpgv02w
# UTxO value
value: 10000
</code></pre>
<h2><a class="header" href="#post-transaction" id="post-transaction">Post transaction</a></h2>
<p>Posts a signed, hex-encoded transaction</p>
<pre><code>jcli rest v0 message post &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>-f --file &lt;file_path&gt; - File containing hex-encoded transaction.
If not provided, transaction will be read from stdin.</li>
</ul>
<p>Fragment Id is printed on success (which can help finding transaction status using get message log command)</p>
<pre><code>50f21ac6bd3f57f231c4bf9c5fff7c45e2529c4dffed68f92410dbf7647541f1
</code></pre>
<h2><a class="header" href="#get-message-log" id="get-message-log">Get message log</a></h2>
<p>Get the node's logs on the message pool. This will provide information on pending transaction,
rejected transaction and or when a transaction has been added in a block</p>
<pre><code>jcli rest v0 message logs &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
- fragment_id: 7db6f91f3c92c0aef7b3dd497e9ea275229d2ab4dba6a1b30ce6b32db9c9c3b2 # hex-encoded fragment ID
  last_updated_at: 	2019-06-02T16:20:26.201000000Z                              # RFC3339 timestamp of last fragment status change
  received_at: 2019-06-02T16:20:26.201000000Z                                   # RFC3339 timestamp of fragment receivement
  received_from: Network,                                                       # how fragment was received
  status: Pending,                                                              # fragment status
</code></pre>
<p><code>received_from</code> can be one of:</p>
<pre><code class="language-yaml">received_from: Rest     # fragment was received from node's REST API
</code></pre>
<pre><code class="language-yaml">received_from: Network  # fragment was received from the network
</code></pre>
<p><code>status</code> can be one of:</p>
<pre><code class="language-yaml">status: Pending                 # fragment is pending
</code></pre>
<pre><code class="language-yaml">status:
  Rejected:                     # fragment was rejected
    reason: reason of rejection # cause
</code></pre>
<pre><code class="language-yaml">status:                         # fragment was included in a block
  InABlock:
    date: &quot;6637.3&quot;            # block epoch and slot ID formed as &lt;epoch&gt;.&lt;slot_id&gt;
    block: &quot;d9040ca57e513a36ecd3bb54207dfcd10682200929cad6ada46b521417964174&quot;
</code></pre>
<h2><a class="header" href="#blockchain-tip" id="blockchain-tip">Blockchain tip</a></h2>
<p>Retrieves a hex-encoded ID of the blockchain tip</p>
<pre><code>jcli rest v0 tip get &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<h2><a class="header" href="#get-block" id="get-block">Get block</a></h2>
<p>Retrieves a hex-encoded block with given ID</p>
<pre><code>jcli rest v0 block &lt;block_id&gt; get &lt;options&gt;
</code></pre>
<p>&lt;block_id&gt; - hex-encoded block ID</p>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<h2><a class="header" href="#get-next-block-id" id="get-next-block-id">Get next block ID</a></h2>
<p>Retrieves a list of hex-encoded IDs of descendants of block with given ID.
Every list element is in separate line. The IDs are sorted from closest to farthest.</p>
<pre><code>jcli rest v0 block &lt;block_id&gt; next-id get &lt;options&gt;
</code></pre>
<p>&lt;block_id&gt; - hex-encoded block ID</p>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>-c --count <count> - Maximum number of IDs, must be between 1 and 100, default 1</li>
</ul>
<h2><a class="header" href="#get-account-state" id="get-account-state">Get account state</a></h2>
<p>Get account state</p>
<pre><code>jcli rest v0 account get &lt;account-id&gt; &lt;options&gt;
</code></pre>
<p><account-id> - ID of an account, bech32-encoded</p>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
counter: 1
delegation: c780f14f9782770014d8bcd514b1bc664653d15f73a7158254730c6e1aa9f356
value: 990
</code></pre>
<ul>
<li><code>value</code> is the current balance of the account;</li>
<li><code>counter</code> is the number of transactions performed using this account
this is useful to know when signing new transactions;</li>
<li><code>delegation</code> is the Stake Pool Identifier the account is delegating to.
it is possible this value is not set if there is no delegation certificate
sent associated to this account.</li>
</ul>
<h2><a class="header" href="#node-settings" id="node-settings">Node settings</a></h2>
<p>Fetches node settings</p>
<pre><code>jcli rest v0 settings get &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
block0Hash: 8d94ecfcc9a566f492e6335858db645691f628b012bed4ac2b1338b5690355a7  # block 0 hash of
block0Time: &quot;2019-07-09T12:32:51+00:00&quot;         # block 0 creation time of
blockContentMaxSize: 102400                     # the block content's max size in bytes
consensusVersion: bft                           # currently used consensus
currSlotStartTime: &quot;2019-07-09T12:55:11+00:00&quot;  # current slot start time
epochStabilityDepth: 102400                     # the depth, number of blocks, to which we consider the blockchain to be stable and prevent rollback beyond that depth
fees:                                           # transaction fee configuration
  certificate: 4                                # fee per certificate
  coefficient: 1                                # fee per every input and output
  constant: 2                                   # fee per transaction
  per_certificate_fees:                         # fee per certificate operations, all zero if this object absent (optional)
    certificate_pool_registration: 5            # fee per pool registration, zero if absent (optional)
    certificate_stake_delegation: 15            # fee per stake delegation, zero if absent (optional)
    certificate_owner_stake_delegation: 2       # fee per pool owner stake delegation, zero if absent (optional)
rewardParams:                                   # parameters for rewards calculation
  compoundingRatio:                             # speed at which reward is reduced. Expressed as numerator/denominator
    denominator: 1024
    numerator: 1
  compoundingType: Linear                       # reward reduction algorithm. Possible values: &quot;Linear&quot; and &quot;Halvening&quot;
  epochRate: 100                                # number of epochs between reward reductions
  epochStart: 0                                 # epoch when rewarding starts
  initialValue: 10000                           # initial reward
slotDuration: 5                                 # slot duration in seconds
slotsPerEpoch: 720                              # number of slots per epoch
treasuryTax:                                    # tax from reward that goes to pot
  fixed: 5                                      # what get subtracted as fixed value
  ratio:                                        # ratio of tax after fixed amount is subtracted. Expressed as numerator/denominator
    numerator: 1
    denominator: 10000
  max: 100                                      # limit of tax (optional)
</code></pre>
<h2><a class="header" href="#node-shutdown" id="node-shutdown">Node shutdown</a></h2>
<p>Node shutdown</p>
<pre><code>jcli rest v0 shutdown get &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<h2><a class="header" href="#get-leaders" id="get-leaders">Get leaders</a></h2>
<p>Fetches list of leader IDs</p>
<pre><code>jcli rest v0 leaders get &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
- 1 # list of leader IDs
- 2
</code></pre>
<h2><a class="header" href="#register-leader" id="register-leader">Register leader</a></h2>
<p>Register new leader and get its ID</p>
<pre><code>jcli rest v0 leaders post &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="jcli/rest.html#conventions">conventions</a>
-f, --file <file> - File containing YAML with leader secret. It must have the same format as secret YAML passed to Jormungandr as --secret. If not provided, YAML will be read from stdin.</li>
</ul>
<p>On success created leader ID is printed</p>
<pre><code>3
</code></pre>
<h2><a class="header" href="#delete-leader" id="delete-leader">Delete leader</a></h2>
<p>Delete leader with given ID</p>
<pre><code>jcli rest v0 leaders delete &lt;id&gt; &lt;options&gt;
</code></pre>
<p><id> - ID of deleted leader</p>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<h2><a class="header" href="#get-leadership-logs" id="get-leadership-logs">Get leadership logs</a></h2>
<p>Fetches leadership logs</p>
<pre><code>jcli rest v0 leaders logs get &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
- created_at_time: &quot;2019-08-19T12:25:00.417263555+00:00&quot;
  enclave_leader_id: 1
  finished_at_time: &quot;2019-08-19T23:19:05.010113333+00:00&quot;
  scheduled_at_date: &quot;0.3923&quot;
  scheduled_at_time: &quot;2019-08-19T23:18:35+00:00&quot;
  wake_at_time: &quot;2019-08-19T23:18:35.001254555+00:00&quot;
  status:
    Block:
      chain_length: 201018,
      block: &quot;d9040ca57e513a36ecd3bb54207dfcd10682200929cad6ada46b521417964174&quot;

</code></pre>
<p>Different value for the status:</p>
<pre><code class="language-yaml"># meaning the action is still pending to happen
status: Pending
</code></pre>
<pre><code class="language-yaml"># meaning the action successfully create the given block with the given hash
status:
  Block:
    chain_length: 201018,
    block: &quot;d9040ca57e513a36ecd3bb54207dfcd10682200929cad6ada46b521417964174&quot;
</code></pre>
<pre><code class="language-yaml"># meaning the event has failed for some reasons
status:
  Rejected:
    reason: &quot;Missed the deadline to compute the schedule&quot;
</code></pre>
<h2><a class="header" href="#get-stake-pools" id="get-stake-pools">Get stake pools</a></h2>
<p>Fetches list of stake pool IDs</p>
<pre><code>jcli rest v0 stake-pools get &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
- 5cf03f333f37eb7b987dbc9017b8a928287a3d77d086cd93cd9ad05bcba7e60f # list of stake pool IDs
- 3815602c096fcbb91072f419c296c3dfe1f730e0f446a9bd2553145688e75615
</code></pre>
<h2><a class="header" href="#get-stake-distribution" id="get-stake-distribution">Get stake distribution</a></h2>
<p>Fetches stake information</p>
<pre><code>jcli rest v0 stake get &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
epoch: 228      # Epoch of last block
stake:
  dangling: 0 # Total value stored in accounts, but assigned to nonexistent pools
  pools:
    - - 5cf03f333f37eb7b987dbc9017b8a928287a3d77d086cd93cd9ad05bcba7e60f # stake pool ID
      - 1000000000000                                                    # staked value
    - - 3815602c096fcbb91072f419c296c3dfe1f730e0f446a9bd2553145688e75615 # stake pool ID
      - 1000000000000                                                    # staked value
  unassigned: 0 # Total value stored in accounts, but not assigned to any pool
</code></pre>
<h2><a class="header" href="#network-stats" id="network-stats">Network stats</a></h2>
<p>Fetches network stats</p>
<pre><code>jcli rest v0 network stats get &lt;options&gt;
</code></pre>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
- # node address (optional)
  addr: &quot;3.124.55.91:3000&quot;
  # hex-encoded node ID
  nodeId: 0102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f20
  # timestamp of when the connection was established
  establishedAt: &quot;2019-10-14T06:24:12.010231281+00:00&quot;
  # timestamp of last time block was received from node if ever (optional)
  lastBlockReceived: &quot;2019-10-14T00:45:57.419496113+00:00&quot;
  # timestamp of last time fragment was received from node if ever (optional)
  lastFragmentReceived: &quot;2019-10-14T00:45:58.419496150+00:00&quot;
  # timestamp of last time gossip was received from node if ever (optional)
  lastGossipReceived: &quot;2019-10-14T00:45:59.419496188+00:00&quot;
</code></pre>
<h2><a class="header" href="#get-stake-pool-details" id="get-stake-pool-details">Get stake pool details</a></h2>
<p>Fetches stake pool details</p>
<pre><code>jcli rest v0 stake-pool get &lt;pool-id&gt; &lt;options&gt;
</code></pre>
<p><pool-id> - hex-encoded pool ID</p>
<p>The options are</p>
<ul>
<li>-h &lt;node_addr&gt; - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--debug - see <a href="jcli/rest.html#conventions">conventions</a></li>
<li>--output-format <format> - see <a href="jcli/rest.html#conventions">conventions</a></li>
</ul>
<p>YAML printed on success</p>
<pre><code class="language-yaml">---
tax:                        # pool reward
  fixed: 5                  # what get subtracted as fixed value
  ratio:                    # ratio of tax after fixed amount is subtracted. Expressed as numerator/denominator
    numerator: 1
    denominator: 10000
  max: 100                  # limit of tax (optional)
total_stake: 2000000000000  # total stake pool value
# bech32-encoded stake pool KES key
kesPublicKey: kes25519-12-pk1q7susucqwje0lpetqzjgzncgcrjzx7e2guh900qszdjskkeyqpusf3p39r
# bech32-encoded stake pool VRF key
vrfPublicKey: vrf_pk1rcm4qm3q9dtwq22x9a4avnan7a3k987zvepuxwekzj3uyu6a8v0s6sdy0l
</code></pre>
<h1><a class="header" href="#staking-with-jormungandr" id="staking-with-jormungandr">Staking with jormungandr</a></h1>
<p>Here we will describe how to:</p>
<ul>
<li><em>delegate your stake to a stake pool</em> so that you can participate to the consensus
and maybe collect rewards for that;</li>
</ul>
<p>If you are a user of the blockchain then you will certainly not need to look
at the last section about <em>how to register a stake pool</em>.</p>
<h1><a class="header" href="#delegating-your-stake" id="delegating-your-stake">Delegating your stake</a></h1>
<h2><a class="header" href="#how-to-create-the-delegation-certificate" id="how-to-create-the-delegation-certificate">how to create the delegation certificate</a></h2>
<p>Stake is concentrated in accounts, and you will need account public key to delegate its associated stake.</p>
<h3><a class="header" href="#for-own-account" id="for-own-account">for own account</a></h3>
<p>You will need:</p>
<ul>
<li>the Stake Pool ID: an hexadecimal string identifying the stake pool you want
to delegate your stake to.</li>
</ul>
<pre><code class="language-sh">jcli certificate new owner-stake-delegation STAKE_POOL_ID &gt; stake_delegation.cert
</code></pre>
<p>Note that the certificate is in blaco, there's no account key used for its creation.
In order for delegation to work it must be submitted to a node inside a very specific transaction:</p>
<ul>
<li>Transaction must have exactly 1 input</li>
<li>The input must be from account</li>
<li>The input value must be strictly equal to fee of the transaction</li>
<li>Transaction must have 0 outputs</li>
</ul>
<p>The account used for input will have its stake delegated to the stake pool</p>
<h3><a class="header" href="#for-any-account" id="for-any-account">for any account</a></h3>
<p>You will need:</p>
<ul>
<li>account public key: a bech32 string of a public key</li>
<li>the Stake Pool ID: an hexadecimal string identifying the stake pool you want
to delegate your stake to.</li>
</ul>
<pre><code class="language-sh">jcli certificate new stake-delegation ACCOUNT_PUBLIC_KEY STAKE_POOL_ID --output stake_delegation.cert
</code></pre>
<h2><a class="header" href="#submitting-to-a-node" id="submitting-to-a-node">submitting to a node</a></h2>
<p>The <code>jcli transaction add-certificate</code> command should be used to add a certificate <strong>before finalizing</strong> the transaction.</p>
<p>For example:</p>
<pre><code class="language-sh">
...

jcli transaction add-certificate $(cat stake_delegation.cert) --staging tx
jcli transaction finalize CHANGE_ADDRESS --fee-constant 5 --fee-coefficient 2 --fee-certificate 2 --staging tx

...
jcli transaction seal --staging tx
jcli transaction auth --key account_key.prv --staging tx
...

</code></pre>
<p>The <code>--fee-certificate</code> flag indicates the cost of adding a certificate, used for computing the fees, it can be omitted if it is zero.</p>
<p>See <a href="stake_pool/../jcli/transaction.html">here</a> for more documentation on transaction creation.</p>
<h2><a class="header" href="#how-to-sign-your-delegation-certificate" id="how-to-sign-your-delegation-certificate">how to sign your delegation certificate</a></h2>
<p>This procedure is needed only for certificates that are to be included
in the <code>genesis config</code> file.</p>
<p>We need to make sure that the owner of the account is authorizing this
delegation to happens, and for that we need a cryptographic signature.</p>
<p>We will need the account secret key to create a signature</p>
<pre><code class="language-sh">jcli certificate sign --certificate stake_delegation.cert --key account_key.prv --output stake_delegation.signedcert
</code></pre>
<p>The content of <code>stake_delegation.signedcert</code> will be something like:</p>
<pre><code class="language-sh">signedcert1q9uxkxptz3zx7akmugkmt4ecjjd3nmzween2qfr5enhzkt37tdt4uqt0j0039z5048mu9ayv3ujep5sl28q2cpdnx9fkvpq30lmjrrgtmqqctzczvu6e3v65m40n40c3y2pnu4vhd888dygkrtnfm0ts92fe50jy0h0ugh6wlvgy4xvr3lz4uuqzg2xgu6vv8tr24jrwhg0l09klp5wvwzl5
</code></pre>
<p>and can now be added in the <code>genesis config</code> file.</p>
<h1><a class="header" href="#registering-stake-pool" id="registering-stake-pool">registering stake pool</a></h1>
<p>There are multiple components to be aware of when running a stake pool:</p>
<ul>
<li>your <code>NodeId</code>: it is the identifier within the blockchain protocol (wallet
will delegate to your stake pool via this <code>NodeId</code>);</li>
<li>your <a href="https://en.wikipedia.org/wiki/Verifiable_random_function"><strong>VRF</strong></a> key pairs: this is the cryptographic material we will use to participate
to the leader election;</li>
<li>your <strong>KES</strong> key pairs: this is the cryptographic material we will use to sign the
block with.</li>
<li>the stake pool <strong>Tax</strong>: the value the stake pool will take from the total reward due to
the stake pool before distributing rewards (if any left) to the delegators.</li>
</ul>
<p>So in order to start your stake pool you will need to generate these objects.</p>
<h2><a class="header" href="#the-primitives" id="the-primitives">The primitives</a></h2>
<h3><a class="header" href="#vrf-key-pair" id="vrf-key-pair">VRF key pair</a></h3>
<p>To generate your <a href="https://en.wikipedia.org/wiki/Verifiable_random_function"><strong>VRF</strong></a> Key pairs, we will utilise <a href="stake_pool/../jcli/introduction.html"><code>jcli</code></a> as described
<a href="stake_pool/../jcli/key.html">here</a>:</p>
<pre><code class="language-sh">jcli key generate --type=Curve25519_2HashDH &gt; stake_pool_vrf.prv
</code></pre>
<p><code>stake_pool_vrf.prv</code> file now contains the VRF private key.</p>
<pre><code class="language-sh">cat stake_pool_vrf.prv | jcli key to-public &gt; stake_pool_vrf.pub
</code></pre>
<h3><a class="header" href="#kes-key-pair" id="kes-key-pair">KES key pair</a></h3>
<p>Similar to above:</p>
<pre><code class="language-sh">jcli key generate --type=SumEd25519_12 &gt; stake_pool_kes.prv
</code></pre>
<p><code>stake_pool_kes.prv</code> now contains your KES private key</p>
<pre><code class="language-sh">cat stake_pool_kes.prv | jcli key to-public &gt; stake_pool_kes.pub
</code></pre>
<h2><a class="header" href="#choosing-the-tax-parameters" id="choosing-the-tax-parameters">Choosing the <strong>Tax</strong> parameters</a></h2>
<p>There are 3 values you can set to configure the stake pool's <strong>Tax</strong>:</p>
<ul>
<li><code>tax-fixed</code>: this is the fixed cut the stake pool will take from the total reward due to
the stake pool;</li>
<li><code>tax-ratio</code>: this is the percentage of the remaining value that will be taken from the total due</li>
<li><code>tax-limit</code>: a value that can be set to limit the pool's <strong>Tax</strong>.</li>
</ul>
<p>All of these values are optionals, if not set, they will be set to <code>0</code>. This will mean
no tax for the stake pool: rewards are all distributed to the delegators.</p>
<h3><a class="header" href="#so-how-does-this-works" id="so-how-does-this-works">So how does this works</a></h3>
<p>Let say you control a stake pool <code>SP</code>, with 2 owners (<code>O1</code> and <code>O2</code>). During epoch 1, <code>SP</code> has
created some blocks and is entitled to receive <code>10_000</code>.</p>
<p>Before distributing the <code>10_000</code> among the delegators, <code>SP</code> will take its <strong>Tax</strong>.</p>
<ol>
<li>we extract the <code>tax-fixed</code>. If this is greater or equal to the total (<code>10_000</code>)
then we stop there, there is no more rewards to distribute.</li>
<li>with what remains the <code>SP</code> extracts its <code>tax-ratio</code> and checks the <strong>tax</strong> from the ratio
is not greater than <code>tax-limit</code>.</li>
<li>the total <code>SP</code> rewards will then be distributed equally to the owners (O1 and O2).
Note that if the <code>--reward-account</code> is set, the rewards for <code>SP</code> are then distributed
to that account and nothing to <code>O1</code> and <code>O2</code>.</li>
</ol>
<p>For example:</p>
<table><thead><tr><th></th><th align="center">total</th><th align="center">fixed</th><th align="center">ratio</th><th align="center">limit</th><th align="center"><code>SP</code></th><th align="center"><code>O1</code></th><th align="center"><code>O2</code></th><th align="center">for delegators</th></tr></thead><tbody>
<tr><td>takes 100%</td><td align="center">10000</td><td align="center">0</td><td align="center">1/1</td><td align="center">0</td><td align="center">10000</td><td align="center">5000</td><td align="center">5000</td><td align="center">0</td></tr>
<tr><td>fixed of 1000</td><td align="center">10000</td><td align="center">1000</td><td align="center">0/1</td><td align="center">0</td><td align="center">1000</td><td align="center">500</td><td align="center">500</td><td align="center">9000</td></tr>
<tr><td>fixed + 10%</td><td align="center">2000</td><td align="center">1000</td><td align="center">1/10</td><td align="center">0</td><td align="center">1100</td><td align="center">550</td><td align="center">550</td><td align="center">900</td></tr>
<tr><td>fixed + 20% up to 150</td><td align="center">2000</td><td align="center">1000</td><td align="center">1/5</td><td align="center">150</td><td align="center">1150</td><td align="center">575</td><td align="center">575</td><td align="center">850</td></tr>
</tbody></table>
<h3><a class="header" href="#the-options-to-set" id="the-options-to-set">The options to set</a></h3>
<pre><code>--tax-limit &lt;TAX_LIMIT&gt;
    The maximum tax value the stake pool will take.

    This will set the maximum the stake pool value will reserve for themselves from the `--tax-ratio` (excluding `--tax-fixed`).
--tax-ratio &lt;TAX_RATIO&gt;
    The percentage take of the stake pool.

    Once the `tax-fixed` has been take, this is the percentage the stake pool will take for themselves. [default: 0/1]
--tax-fixed &lt;TAX_VALUE&gt;
    set the fixed value tax the stake pool will reserve from the reward

    For example, a stake pool may set this value to cover their fixed operation costs. [default: 0]
</code></pre>
<h2><a class="header" href="#creating-a-stake-pool-certificate" id="creating-a-stake-pool-certificate">creating a stake pool certificate</a></h2>
<p>The certificate is what will be sent to the blockchain in order to register
yourself to the other participants of the blockchain that you are a stake
pool too.</p>
<pre><code class="language-sh">jcli certificate new stake-pool-registration \
    --kes-key $(cat stake_pool_kes.pub) \
    --vrf-key $(cat stake_pool_vrf.pub) \
    --start-validity 0 \
    --management-threshold 1 \
    --tax-fixed 1000000 \
    --tax-limit 1000000000 \
    --tax-ratio &quot;1/10&quot; \
    --owner $(cat owner_key.pub) &gt; stake_pool.cert
</code></pre>
<p>The <code>--operator</code> flag is optional.</p>
<p>And now you can retrieve your stake pool id (<code>NodeId</code>):</p>
<pre><code class="language-sh">cat stake_pool.cert | jcli certificate get-stake-pool-id | tee stake_pool.id
ea830e5d9647af89a5e9a4d4089e6e855891a533316adf4a42b7bf1372389b74
</code></pre>
<h2><a class="header" href="#submitting-to-a-node-1" id="submitting-to-a-node-1">submitting to a node</a></h2>
<p>The <code>jcli transaction add-certificate</code> command should be used to add a certificate <strong>before finalizing</strong> the transaction.</p>
<p>For example:</p>
<pre><code class="language-sh">...

jcli transaction add-certificate $(cat stake_pool.cert) --staging tx
jcli transaction finalize CHANGE_ADDRESS --fee-constant 5 --fee-coefficient 2 --fee-certificate 2 --staging tx

...
jcli transaction seal --staging tx
jcli transaction auth --key owner_key.prv --staging tx
...
</code></pre>
<p>The <code>--fee-certificate</code> flag indicates the cost of adding a certificate, used for computing the fees, it can be omitted if it is zero.</p>
<p>See <a href="stake_pool/../jcli/transaction.html">here</a> for more documentation on transaction creation.</p>
<h1><a class="header" href="#advanced-1" id="advanced-1">Advanced</a></h1>
<p>This section is meant for advanced users and developers of the node, or if
you to learn more about the node.</p>
<p>At the moment, it only covers details on how to create your own blockchain genesis
configuration, but in normal case, the blockchain configuration should be available
with the specific blockchain system.</p>
<h1><a class="header" href="#genesis-file" id="genesis-file">genesis file</a></h1>
<p>The genesis file is the file that allows you to create a new blockchain
from block 0. It lays out the different parameter of your blockchain:
the initial utxo, the start time, the slot duration time, etc...</p>
<p>Example of a BFT genesis file with an initial address UTxO and an account UTxO.
More info regarding <a href="advanced/./02_starting_bft_blockchain.html">starting a BFT blockchain here</a>
and <a href="advanced/../jcli/address.html">regarding addresses there</a>.
You could also find information regarding the <a href="advanced/../jcli/genesis.html">jcli genesis tooling</a>.</p>
<p>You can generate a documented pre-generated genesis file:</p>
<pre><code>jcli genesis init
</code></pre>
<p>For example your genesis file may look like:</p>
<pre><code class="language-yaml"># The Blockchain Configuration defines the settings of the blockchain.
blockchain_configuration:

  # The block0-date defines the date the blockchain starts
  # expected value in seconds since UNIX_EPOCH
  #
  # By default the value will be the current date and time. Or you can
  # add a specific time by entering the number of seconds since UNIX
  # Epoch
  block0_date: {default_block0_date}

  # This is the type of discrimination of the blockchain
  # of this blockchain is meant for production then
  # use 'production' instead.
  #
  # otherwise leave as this
  discrimination: {discrimination}

  # The initial consensus version:
  #
  # * BFT consensus: bft
  # * Genesis Praos consensus: genesis
  block0_consensus: bft

  # Number of slots in each epoch.
  #
  # default value is {default_slots_per_epoch}
  slots_per_epoch: {default_slots_per_epoch}

  # The slot duration, in seconds, is the time between the creation
  # of 2 blocks
  #
  # default value is {default_slot_duration}
  slot_duration: {default_slot_duration}

  # set the block content max size
  #
  # This is the size, in bytes, of all the contents of the block (excluding the
  # block header).
  #
  # default value is {default_block_content_max_size}
  block_content_max_size: {default_block_content_max_size}

  # A list of Ed25519 PublicKey that represents the
  # BFT leaders encoded as bech32. The order in the list matters.
  consensus_leader_ids:
    - {leader_1}
    - {leader_2}

  # Epoch stability depth
  #
  # Optional: default value {default_epoch_stability_depth}
  epoch_stability_depth: {default_epoch_stability_depth}

  # Genesis praos active slot coefficient
  # Determines minimum stake required to try becoming slot leader, must be in range (0,1]
  #
  # default value: {default_consensus_genesis_praos_active_slot_coeff}
  consensus_genesis_praos_active_slot_coeff: {default_consensus_genesis_praos_active_slot_coeff}

  # The fee calculations settings
  #
  # total fees: constant + (num_inputs + num_outputs) * coefficient [+ certificate]
  linear_fees:
    # this is the minimum value to pay for every transaction
    constant: 2
    # the additional fee to pay for every inputs and outputs
    coefficient: 1
    # the additional fee to pay if the transaction embeds a certificate
    certificate: 4
    # (optional) fees for different types of certificates, to override the one
    # given in `certificate` just above
    #
    # here: all certificate fees are set to `4` except for pool registration
    # and stake delegation which are respectively `5` and `2`.
    per_certificate_fees:
      # (optional) if not specified, the pool registration certificate fee will be
      # the one set by linear_fees.certificate
      certificate_pool_registration: 5
      # (optional) if not specified, the delegation certificate fee will be
      # the one set by linear_fees.certificate
      certificate_stake_delegation: 2
      # (optional) if not specified, the owner delegation certificate fee will be
      # the one set by linear_fees.certificate. Uncomment to set the owner stake
      # delegation to `1` instead of default `4`:
      # certificate_owner_stake_delegation: 1

  # The speed to update the KES Key in seconds
  #
  # default value: {default_kes_update_speed}
  kes_update_speed: {default_kes_update_speed}

  # Set where to send the fees generated by transactions activity.
  #
  # by default it is send to the &quot;rewards&quot; pot of the epoch which is then
  # distributed to the different stake pools who created blocks that given
  # epoch.
  #
  # It is possible to send all the generated fees to the &quot;treasury&quot;.
  #
  # Optional, default is &quot;rewards&quot;
  # fees_go_to: &quot;rewards&quot;

  # initial value the treasury will start with, if not set the treasury
  # starts at 0
  treasury: 1000000000000

  # set the treasury parameters, this is the tax type, just as in stake pool
  # registration certificate parameters.
  #
  # When distributing the rewards, the treasury will be first serve as per
  # the incentive specification document
  #
  # if not set, the treasury will not grow
  treasury_parameters:
    # the fix value the treasury will take from the total reward pot of the epoch
    fixed: 1000
    # the extra percentage the the treasury will take from the reward pot of the epoch
    ratio: &quot;1/10&quot;
    # It is possible to add a max bound to the total value the treasury takes
    # at each reward distribution. For example, one could cap the treasury tax
    # to 10000. Uncomment the following line to apply a max limit:
    # max_limit: 10000

  # Set the total reward supply available for monetary creation
  #
  # if not set there is no monetary creation
  # once emptied, there is no more monetary creation
  total_reward_supply: 100000000000000

  # set the reward supply consumption. These parameters will define how the
  # total_reward_supply is consumed for the stake pool reward
  #
  # There's fundamentally many potential choices for how rewards are contributed back, and here's two potential valid examples:
  #
  # Linear formula: constant - ratio * (#epoch after epoch_start / epoch_rate)
  # Halving formula: constant * ratio ^ (#epoch after epoch_start / epoch_rate)
  #
  reward_parameters:
    halving: # or use &quot;linear&quot; for the linear formula
      # In the linear formula, it represents the starting point of the contribution
      # at #epoch=0, whereas in halving formula is used as starting constant for
      # the calculation.
      constant: 100

      # In the halving formula, an effective value between 0.0 to 1.0 indicates a
      # reducing contribution, whereas above 1.0 it indicate an acceleration of contribution.
      #
      # However in linear formula the meaning is just a scaling factor for the epoch zone
      # (current_epoch - start_epoch / epoch_rate). Further requirement is that this ratio
      # is expressed in fractional form (e.g. 1/2), which allow calculation in integer form.
      ratio: &quot;13/19&quot;

      # indicates when this contribution start. note that if the epoch is not
      # the same or after the epoch_start, the overall contribution is zero.
      epoch_start: 1

      # the rate at which the contribution is tweaked related to epoch.
      epoch_rate: 3

  # set some reward constraints and limits
  #
  # this value is optional, the default is no constraints at all. The settings
  # are commented below:
  #
  #reward_constraints:
  #  # limit the epoch total reward drawing limit to a portion of the total
  #  # active stake of the system.
  #  #
  #  # for example, if set to 10%, the reward drawn will be bounded by the
  #  # 10% of the total active stake.
  #  #
  #  # this value is optional, the default is no reward drawing limit
  #  reward_drawing_limit_max: &quot;10/100&quot;
  #
  #  # settings to incentivize the numbers of stake pool to be registered
  #  # on the blockchain.
  #  #
  #  # These settings does not prevent more stake pool to be added. For example
  #  # if there is already 1000 stake pools, someone can still register a new
  #  # stake pool and affect the rewards of everyone else too.
  #  #
  #  # if the threshold is reached, the pool doesn't really have incentive to
  #  # create more blocks than 1 / set-value-of-pools % of stake.
  #  #
  #  # this value is optional, the default is no pool participation capping
  #  pool_participation_capping:
  #    min: 300
  #    max: 1000

# Initial state of the ledger. Each item is applied in order of this list
initial:
  # Initial deposits present in the blockchain
  - fund:
      # UTxO addresses or account
      - address: {initial_funds_address}
        value: 10000

  # Initial certificates
  #- cert: ..

  # Initial deposits present in the blockchain
  #- legacy_fund:
  #    # Legacy Cardano address
  #    - address: 48mDfYyQn21iyEPzCfkATEHTwZBcZJqXhRJezmswfvc6Ne89u1axXsiazmgd7SwT8VbafbVnCvyXhBSMhSkPiCezMkqHC4dmxRahRC86SknFu6JF6hwSg8
  #      value: 123
</code></pre>
<p>There are multiple <em>parts</em> in the genesis file:</p>
<ul>
<li><code>blockchain_configuration</code>: this is a list of configuration
parameters of the blockchain, some of which can be changed later
via the update protocol;</li>
<li><code>initial</code>: list of steps to create initial state of ledger</li>
</ul>
<h2><a class="header" href="#blockchain_configuration-options" id="blockchain_configuration-options"><code>blockchain_configuration</code> options</a></h2>
<table><thead><tr><th align="left">option</th><th align="left">format</th><th align="left">description</th></tr></thead><tbody>
<tr><td align="left"><code>block0_date</code></td><td align="left">number</td><td align="left">the official start time of the blockchain, in seconds since UNIX EPOCH</td></tr>
<tr><td align="left"><code>discrimination</code></td><td align="left">string</td><td align="left"><code>production</code> or <code>test</code></td></tr>
<tr><td align="left"><code>block0_consensus</code></td><td align="left">string</td><td align="left"><code>bft</code></td></tr>
<tr><td align="left"><code>slot_duration</code></td><td align="left">number</td><td align="left">the number of seconds between the creation of 2 blocks</td></tr>
<tr><td align="left"><code>epoch_stability_depth</code></td><td align="left">number</td><td align="left">allowed size of a fork (in number of block)</td></tr>
<tr><td align="left"><code>consensus_leader_ids</code></td><td align="left">array</td><td align="left">the list of the BFT leader at the beginning of the blockchain</td></tr>
<tr><td align="left"><code>block_content_max_size</code></td><td align="left">number</td><td align="left">the maximum size of the block content, in bytes.</td></tr>
<tr><td align="left"><code>linear_fees</code></td><td align="left">object</td><td align="left">linear fee settings, set the fee for transaction and certificate publishing</td></tr>
<tr><td align="left"><code>consensus_genesis_praos_active_slot_coeff</code></td><td align="left">number</td><td align="left">genesis praos active slot coefficient.  Determines minimum stake required to try becoming slot leader, must be in range (0,1]</td></tr>
<tr><td align="left"><code>kes_update_speed</code></td><td align="left">number</td><td align="left">the speed to update the KES Key in seconds</td></tr>
<tr><td align="left"><code>slots_per_epoch</code></td><td align="left">number</td><td align="left">number of slots in each epoch</td></tr>
</tbody></table>
<p><em>for more information about the BFT leaders in the genesis file, see
<a href="advanced/./02_starting_bft_blockchain.html">Starting a BFT Blockchain</a></em></p>
<h2><a class="header" href="#initial-options" id="initial-options"><code>initial</code> options</a></h2>
<p>Each entry can be one of 3 variants:</p>
<table><thead><tr><th align="left">variant</th><th align="left">format</th><th align="left">description</th></tr></thead><tbody>
<tr><td align="left"><code>fund</code></td><td align="left">sequence</td><td align="left">initial deposits present in the blockchain (up to 255 outputs per entry)</td></tr>
<tr><td align="left"><code>cert</code></td><td align="left">string</td><td align="left">initial certificate</td></tr>
<tr><td align="left"><code>legacy_fund</code></td><td align="left">sequence</td><td align="left">same as <code>fund</code>, but with legacy Cardano address format</td></tr>
</tbody></table>
<p>Example:</p>
<pre><code class="language-yaml">initial:
  - fund:
      - address: &lt;address&gt;
        value: 10000
      - address: &lt;address2&gt;
        value: 20000
      - address: &lt;address3&gt;
        value: 30000
  - cert: &lt;certificate&gt;
  - legacy_fund:
      - address: &lt;legacy address&gt;
        value: 123
  - fund:
      - address: &lt;another address&gt;
        value: 1001
</code></pre>
<h3><a class="header" href="#fund-and-legacy_fund-format" id="fund-and-legacy_fund-format"><code>fund</code> and <code>legacy_fund</code> format</a></h3>
<table><thead><tr><th align="left">variant</th><th align="left">format</th><th align="left">description</th></tr></thead><tbody>
<tr><td align="left"><code>address</code></td><td align="left">string</td><td align="left">can be a <a href="advanced/../jcli/address.html#address-for-utxo">single address</a> or an <a href="advanced/../jcli/address.html#address-for-account">account address</a></td></tr>
<tr><td align="left"><code>value</code></td><td align="left">number</td><td align="left">assigned value</td></tr>
</tbody></table>
<p><code>legacy_fund</code> differs only in address format, which is legacy Cardano</p>
<h1><a class="header" href="#starting-a-bft-node" id="starting-a-bft-node">starting a bft node</a></h1>
<p>BFT stands for the Byzantine Fault Tolerant
(<a href="https://iohk.io/research/papers/#L5IHCV53">read the paper</a>).</p>
<p>Jormungandr allows you to start a BFT blockchain fairly easily. The main
downside is that it is centralized, only a handful of nodes will ever have
the right to create blocks.</p>
<h2><a class="header" href="#how-does-it-work" id="how-does-it-work">How does it work</a></h2>
<p>It is fairly simple. A given number of Nodes (<code>N</code>) will generate
a key pairs of type <code>Ed25519</code> (see
<a href="advanced/./../jcli/key.html">JCLI's Keys</a>).</p>
<p>They all share the public key and add them in the genesis.yaml file.
It is the source of truth, the file that will generate the first block
of the blockchain: the <strong>Block 0</strong>.</p>
<p>Then, only by one after the other, each Node will be allowed to create a block.
Utilising a Round Robin algorithm.</p>
<h2><a class="header" href="#example-of-genesis-file" id="example-of-genesis-file">Example of genesis file</a></h2>
<pre><code class="language-yaml">blockchain_configuration:
  block0_date: 1550822014
  discrimination: test
  block0_consensus: bft
  slots_per_epoch: 5
  slot_duration: 15
  epoch_stability_depth: 10
  consensus_leader_ids:
    - ed25519e_pk1k3wjgdcdcn23k6dwr0cyh88ad7a4ayenyxaherfazwy363pyy8wqppn7j3
    - ed25519e_pk13talprd9grgaqzs42mkm0x2xek5wf9mdf0eefdy8a6dk5grka2gstrp3en
  consensus_genesis_praos_active_slot_coeff: 0.22
  linear_fees:
    constant: 2
    coefficient: 1
    certificate: 4
  kes_update_speed: 43200
initial:
  - fund:
      - address: ta1svy0mwwm7mdwcuj308aapjw6ra4c3e6cygd0f333nvtjzxg8ahdvxlswdf0
        value: 10000
  - cert: cert1qgqqqqqqqqqqqqqqqqqqq0p5avfqqmgurpe7s9k7933q0wj420jl5xqvx8lywcu5jcr7fwqa9qmdn93q4nm7c4fsay3mzeqgq3c0slnut9kns08yn2qn80famup7nvgtfuyszqzqrd4lxlt5ylplfu76p8f6ks0ggprzatp2c8rn6ev3hn9dgr38tzful4h0udlwa0536vyrrug7af9ujmrr869afs0yw9gj5x7z24l8sps3zzcmv
  - legacy_fund:
      - address: 48mDfYyQn21iyEPzCfkATEHTwZBcZJqXhRJezmswfvc6Ne89u1axXsiazmgd7SwT8VbafbVnCvyXhBSMhSkPiCezMkqHC4dmxRahRC86SknFu6JF6hwSg8
        value: 123
</code></pre>
<p>In order to start your blockchain in BFT mode you need to be sure that:</p>
<ul>
<li><code>consensus_leader_ids</code> is non empty;</li>
</ul>
<p>more information regarding the <a href="advanced/./01_the_genesis_block.html">genesis file here</a>.</p>
<h2><a class="header" href="#creating-the-block-0" id="creating-the-block-0">Creating the block 0</a></h2>
<pre><code>jcli genesis encode --input genesis.yaml --output block-0.bin
</code></pre>
<p>This command will create (or replace) the <strong>Block 0</strong> of the blockchain
from the given genesis configuration file (<code>genesis.yaml</code>).</p>
<h2><a class="header" href="#starting-the-node-3" id="starting-the-node-3">Starting the node</a></h2>
<p>Now that the blockchain is initialized, you need to start your node.</p>
<p>Write you private key in a file on your HD:</p>
<pre><code>$ cat node_secret.yaml
bft:
  signing_key: ed25519_sk1hpvne...
</code></pre>
<p>Configure your Node (config.yml) and run the following command:</p>
<pre><code>$ jormungandr --genesis-block block-0.bin \
    --config example.config \
    --secret node_secret.yaml
</code></pre>
<p>It's possible to use the flag <code>--secret</code> multiple times to run a node
with multiple leaders.</p>
<h2><a class="header" href="#step-by-step-to-start-the-bft-node" id="step-by-step-to-start-the-bft-node">Step by step to start the BFT node</a></h2>
<ol>
<li>Generate initial config <code>jcli genesis init &gt; genesis.yaml</code></li>
<li>Generate secret key, e.g. <code> jcli key generate --type=Ed25519 &gt; key.prv</code></li>
<li>Put secret key in a file, e.g. <code>node_secret.yaml</code> as follows:</li>
</ol>
<pre><code class="language-yaml">bft:
 signing_key: ed25519_sk1kppercsk06k03yk4qgea....
</code></pre>
<ol start="4">
<li>Generate public key out of previously generated key <code> cat key.prv |  jcli key to-public</code></li>
<li>Put generated public key as in <code>genesis.yaml</code> under <code>consensus_leader_ids:</code></li>
<li>Generate block = <code>jcli genesis encode --input genesis.yaml --output block-0.bin</code></li>
<li>Create config file and store it on your HD as <code>node.config</code> e.g. -&gt;</li>
</ol>
<pre><code class="language-yaml">---
log:
  level: trace
  format: json
rest:
  listen: &quot;127.0.0.1:8607&quot;
p2p:
  public_address: /ip4/127.0.0.1/tcp/8606
  topics_of_interest:
    messages: low
    blocks: normal
</code></pre>
<ol start="8">
<li>Start Jörmungandr node :</li>
</ol>
<pre><code>jormungandr --genesis-block block-0.bin --config node.config --secret node_secret.yaml
</code></pre>
<h1><a class="header" href="#script" id="script">Script</a></h1>
<p>Additionally, there is a script <a href="https://github.com/input-output-hk/jormungandr/blob/master/scripts/bootstrap">here</a> that can be used to bootstrap a test node with bft consensus protocol.</p>
<h1><a class="header" href="#starting-a-genesis-blockchain" id="starting-a-genesis-blockchain">starting a genesis blockchain</a></h1>
<p>When starting a genesis praos blockchain there is an element to take
into consideration while constructing the block 0: <em>the stake distribution</em>.</p>
<p>In the context of Genesis/Praos the network is fully decentralized and it is
necessary to think ahead about initial stake pools and to make sure there
is stake delegated to these stake pools.</p>
<p>In your genesis yaml file, make sure to set the following values to the appropriate
values/desired values:</p>
<pre><code class="language-yaml"># The Blockchain Configuration defines the settings of the blockchain.
blockchain_configuration:
  block0_consensus: genesis_praos
  consensus_genesis_praos_active_slot_coeff: 0.1
  kes_update_speed: 43200 # 12hours
</code></pre>
<p><code>block0_consensus</code> set to <code>genesis_praos</code> means you want to start a blockchain with
genesis praos as the consensus layer.</p>
<p><code>consensus_genesis_praos_active_slot_coeff</code> determines minimum stake required to
try becoming slot leader, must be in range 0 exclusive and 1 inclusive.</p>
<h2><a class="header" href="#the-initial-certificates" id="the-initial-certificates">The initial certificates</a></h2>
<p>In the <code>initial_certs</code> field you will set the initial certificate. This is important
to declare the stake pool and delegate stake to them. Otherwise no block will be ever
created.</p>
<p>Remember that in this array the <strong>order</strong> matters:</p>
<p>In order to delegate your stake, you need a stake pool to already exist, so the stake pool registration certificate should go first.</p>
<h3><a class="header" href="#stake-pool-registration" id="stake-pool-registration">Stake pool registration</a></h3>
<p>Now you can register a stake pool.
Follow the instruction in <a href="advanced/../stake_pool/registering_stake_pool.html">registering stake pool guide</a>.</p>
<p>The <em>owner key</em> (the key you sign the stake pool registration certificate) is the secret
key associated to a previously registered stake key.</p>
<h3><a class="header" href="#delegating-stake" id="delegating-stake">Delegating stake</a></h3>
<p>Now that there is both your stake key and there are stake pools available
in the block0 you need to delegate to one of the stake pool. Follow the instruction
in <a href="advanced/../stake_pool/delegating_stake.html">delegating stake</a>.</p>
<p>And in the initial funds start adding the addresses. To create an address with delegation
follow the instruction in <a href="advanced/../jcli/address.html">JCLI's address guide</a>. Utilise the stake key
registered previously as group address:</p>
<pre><code>jcli address single $(cat wallet_key.pub) $(cat stake_key.pub)
ta1sjx4j3jwel94g0cgwzq9au7h6m8f5q3qnyh0gfnryl3xan6qnmjse3k2uv062mzj34eacjnxthxqv8fvdcn6f4xhxwa7ms729ak3gsl4qrq2mm
</code></pre>
<p>You will notice that addresses with delegation are longer (about twice longer) than
address without delegation.</p>
<p>For example, the most minimal setting you may have is:</p>
<pre><code class="language-yaml">initial_certs:
  # register a stake pool (P), owner of the stake pool is the stake key (K)
  - cert1qsqqqqqqqqqqqqqqqqqqq0p5avfqp9tzusr26chayeddkkmdlap6tl23ceca8unsghc22tap8clhrzslkehdycufa4ywvqvs4u36zctw4ydtg7xagprfgz0vuujh3lgtxgfszqzqj4xk4sxxyg392p5nqz8s7ev5wna7eqz7ycsuas05mrupmdsfk0fqqudanew6c0nckf5tsp0lgnk8e8j0dpnxvjk2usn52vs8umr3qrccegxaz

  # delegate stake associated to stake key (K) to stake pool (P)
  - cert1q0rv4ccl54k99rtnm39xvhwvqcwjcm385n2dwvamahpu5tmdz3plt65rpewev3a03xj7nfx5pz0xap2cjxjnxvt2ma9y9dalzder3xm5qyqyq0lx05ggrws0ghuffqrg7scqzdsd665v4m7087eam5zvw4f26v2tsea3ujrxly243sgqkn42uttk5juvq78ajvfx9ttcmj05lfuwtq9qhdxzr0

initial_funds:
  # address without delegation
  - address: ta1swx4j3jwel94g0cgwzq9au7h6m8f5q3qnyh0gfnryl3xan6qnmjsczt057x
    value: 10000
  # address delegating to stake key (K)
  - address: ta1sjx4j3jwel94g0cgwzq9au7h6m8f5q3qnyh0gfnryl3xan6qnmjse3k2uv062mzj34eacjnxthxqv8fvdcn6f4xhxwa7ms729ak3gsl4qrq2mm
    value: 1000000
</code></pre>
<h3><a class="header" href="#starting-the-node-4" id="starting-the-node-4">Starting the node</a></h3>
<p>Now, for starting the node and be able to generate new blocks, you have to put your pool's private keys and id in a file and start the node with the <code>--secret filename</code> parameter.</p>
<hr />
<p>For example, if you follow the examples of the <a href="advanced/../stake_pool/registering_stake_pool.html">registering stake pool guide</a> </p>
<p>You could create a file called poolsecret.yaml with the following content.</p>
<pre><code class="language-yaml">genesis:
  sig_key: Content of stake_pool_kes.prv file
  vrf_key: Content of stake_pool_vrf.prv file
  node_id: Content of stake_pool.id file
</code></pre>
<p>And you could start the node with this command </p>
<pre><code class="language-sh">jormungandr --genesis-block block-0.bin --config config.yaml --secret poolsecret.yaml
</code></pre>
<h1><a class="header" href="#test-script" id="test-script">Test script</a></h1>
<p>There is a script <a href="https://github.com/input-output-hk/jormungandr/blob/master/scripts/bootstrap">here</a> that can be used to bootstrap a test node with a pre-set faucet and stake pool and can be used as an example.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
        
        

    </body>
</html>
